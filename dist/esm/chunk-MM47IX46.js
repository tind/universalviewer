import{a as Qt,c as Lt,e as Rt,f as Mt,g as wt}from"./chunk-UYLDA6E6.js";import{a as Tt,b as R,d as Y,g as Ot,j as ft,k as St,l as D,m as lt,n as At,o as G,p as b}from"./chunk-4W27INWC.js";import{b as V,e as F,g as w}from"./chunk-MP7EINQY.js";import{b as jt,c as et}from"./chunk-YAXTLTJC.js";var Vt=jt((at,Ct)=>{(function(s,i){typeof at=="object"&&typeof Ct=="object"?Ct.exports=i():typeof define=="function"&&define.amd?define("IIIFMetadataComponent",[],i):typeof at=="object"?at.IIIFMetadataComponent=i():s.IIIFMetadataComponent=i()})(typeof self!="undefined"?self:at,function(){return function(s){var i={};function a(u){if(i[u])return i[u].exports;var c=i[u]={i:u,l:!1,exports:{}};return s[u].call(c.exports,c,c.exports,a),c.l=!0,c.exports}return a.m=s,a.c=i,a.d=function(u,c,m){a.o(u,c)||Object.defineProperty(u,c,{enumerable:!0,get:m})},a.r=function(u){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(u,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(u,"__esModule",{value:!0})},a.t=function(u,c){if(1&c&&(u=a(u)),8&c||4&c&&typeof u=="object"&&u&&u.__esModule)return u;var m=Object.create(null);if(a.r(m),Object.defineProperty(m,"default",{enumerable:!0,value:u}),2&c&&typeof u!="string")for(var o in u)a.d(m,o,function(v){return u[v]}.bind(null,o));return m},a.n=function(u){var c=u&&u.__esModule?function(){return u.default}:function(){return u};return a.d(c,"a",c),c},a.o=function(u,c){return Object.prototype.hasOwnProperty.call(u,c)},a.p="",a(a.s=0)}([function(s,i,a){s.exports=a(1)},function(s,i,a){"use strict";var u,c=this&&this.__extends||(u=function(h,e){return(u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)n.hasOwnProperty(r)&&(t[r]=n[r])})(h,e)},function(h,e){function t(){this.constructor=h}u(h,e),h.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)});Object.defineProperty(i,"__esModule",{value:!0});var m,o=a(2),v=a(3),g=a(4);(function(h){h.LINES="lines",h.CHARS="chars"})(m=i.LimitType||(i.LimitType={}));var l=function(h){function e(t){var n=h.call(this,t)||this;return n._data=n.data(),n._data=n.options.data,n._init(),n._resize(),n}return c(e,h),e.prototype._init=function(){return h.prototype._init.call(this),this._$element=$(this.el),this._$metadataGroupTemplate=$('<div class="group">          <div class="header"></div>          <div class="items"></div>      </div>'),this._$metadataItemTemplate=$('<div class="item">          <div class="label"></div>          <div class="values"></div>      </div>'),this._$metadataItemValueTemplate=$('<div class="value"></div>'),this._$metadataItemURIValueTemplate=$('<a class="value" href="" target="_blank"></a>'),this._$copyTextTemplate=$('<div class="copyText" alt="'+this.options.data.content.copyToClipboard+'" title="'+this.options.data.content.copyToClipboard+'">        <div class="copiedText">'+this.options.data.content.copiedToClipboard+" </div>        </div>"),this._$metadataGroups=$('<div class="groups"></div>'),this._$element.append(this._$metadataGroups),this._$noData=$('<div class="noData">'+this.options.data.content.noData+"</div>"),this._$element.append(this._$noData),!0},e.prototype.data=function(){return{aggregateValues:"",canvases:null,canvasDisplayOrder:"",metadataGroupOrder:"",canvasExclude:"",canvasLabels:"",content:{attribution:"Attribution",canvasHeader:"About the canvas",copiedToClipboard:"Copied to clipboard",copyToClipboard:"Copy to clipboard",description:"Description",imageHeader:"About the image",less:"less",license:"License",logo:"Logo",manifestHeader:"About the item",more:"more",noData:"No data to display",rangeHeader:"About the range",sequenceHeader:"About the sequence"},copiedMessageDuration:2e3,copyToClipboardEnabled:!1,helper:null,licenseFormatter:null,limit:4,limitType:m.LINES,limitToRange:!1,manifestDisplayOrder:"",manifestExclude:"",range:null,rtlLanguageCodes:"ar, ara, dv, div, he, heb, ur, urd",sanitizer:function(t){return t},showAllLanguages:!1}},e.prototype._getManifestGroup=function(){return this._metadataGroups.filter(function(t){return t.resource.isManifest()})[0]},e.prototype._getCanvasGroups=function(){return this._metadataGroups.filter(function(t){return t.resource.isCanvas()})},e.prototype.set=function(t){var n=this;if(this._data=Object.assign(this._data,t),this._data&&this._data.helper){var r,d={canvases:this._data.canvases,licenseFormatter:this._data.licenseFormatter,range:this._data.range};if(this._metadataGroups=this._data.helper.getMetadata(d),this._data.manifestDisplayOrder&&((r=this._getManifestGroup()).items=this._sortItems(r.items,this._readCSV(this._data.manifestDisplayOrder))),this._data.canvasDisplayOrder&&this._getCanvasGroups().forEach(function(x,T){x.items=n._sortItems(x.items,n._readCSV(n._data.canvasDisplayOrder))}),this._data.metadataGroupOrder&&(this._metadataGroups=this._sortGroups(this._metadataGroups,this._readCSV(this._data.metadataGroupOrder))),this._data.canvasLabels&&this._label(this._getCanvasGroups(),this._readCSV(this._data.canvasLabels,!1)),this._data.manifestExclude&&((r=this._getManifestGroup()).items=this._exclude(r.items,this._readCSV(this._data.manifestExclude))),this._data.canvasExclude&&this._getCanvasGroups().forEach(function(x,T){x.items=n._exclude(x.items,n._readCSV(n._data.canvasExclude))}),this._data.limitToRange){var E=[];this._metadataGroups.forEach(function(x,T){x.resource.isRange()&&E.push(x)}),E.length&&(this._metadataGroups=E)}this._render()}},e.prototype._sortItems=function(t,n){var r=this,d=[],E=t.slice(0);return n.forEach(function(x,T){var A=E.filter(function(C){return r._normalise(C.getLabel())===x})[0];if(A){d.push(A);var O=E.indexOf(A);O>-1&&E.splice(O,1)}}),E.forEach(function(x,T){d.push(x)}),d},e.prototype._sortGroups=function(t,n){var r=[],d=t.slice(0);return n.forEach(function(E,x){var T=d.filter(function(O){return O.resource.getIIIFResourceType().toLowerCase()==E.toLowerCase()})[0];if(T){r.push(T);var A=d.indexOf(T);A>-1&&d.splice(A,1)}}),r},e.prototype._label=function(t,n){t.forEach(function(r,d){r.label=n[d]})},e.prototype._exclude=function(t,n){var r=this;return n.forEach(function(d,E){var x=t.filter(function(A){return r._normalise(A.getLabel())===d})[0];if(x){var T=t.indexOf(x);T>-1&&t.splice(T,1)}}),t},e.prototype._normalise=function(t){return t?t.toLowerCase().replace(/ /g,""):null},e.prototype._render=function(){var t=this;this._metadataGroups.length?(this._$noData.hide(),this._$metadataGroups.empty(),this._metadataGroups.forEach(function(n,r){var d=t._buildMetadataGroup(n);t._$metadataGroups.append(d);var E=d.find(".value");t._data.limit&&t._data.content&&(t._data.limitType===m.LINES?E.toggleExpandTextByLines(t._data.limit,t._data.content.less,t._data.content.more,function(){}):t._data.limitType===m.CHARS&&E.ellipsisHtmlFixed(t._data.limit,function(){}))})):this._$noData.show()},e.prototype._buildMetadataGroup=function(t){var n=this._$metadataGroupTemplate.clone(),r=n.find(">.header");if(this._data.content){if(t.resource.isManifest()&&this._data.content.manifestHeader)(E=this._sanitize(this._data.content.manifestHeader))&&r.html(E);else if(t.resource.isSequence()&&this._data.content.sequenceHeader)(E=this._sanitize(this._data.content.sequenceHeader))&&r.html(E);else if(t.resource.isRange()&&this._data.content.rangeHeader)(E=this._sanitize(this._data.content.rangeHeader))&&r.html(E);else if(t.resource.isCanvas()&&(t.label||this._data.content.canvasHeader)){var d=t.label||this._data.content.canvasHeader;r.html(this._sanitize(d))}else if(t.resource.isAnnotation()&&this._data.content.imageHeader){var E;(E=this._sanitize(this._data.content.imageHeader))&&r.html(E)}}r.text()||r.hide();for(var x=n.find(".items"),T=0;T<t.items.length;T++){var A=t.items[T],O=this._buildMetadataItem(A);x.append(O)}return n},e.prototype._buildMetadataItem=function(t){var n,r=this._$metadataItemTemplate.clone(),d=r.find(".label"),E=r.find(".values"),x=t.getLabel(),T=x,A=new RegExp("/w+:(/?/?)[^s]+/gm","i");if(this._data.content&&T&&t.isRootLevel)switch(T.toLowerCase()){case"attribution":T=this._data.content.attribution;break;case"description":T=this._data.content.description;break;case"license":T=this._data.content.license;break;case"logo":T=this._data.content.logo}if(T=this._sanitize(T),d.html(T),this._addReadingDirection(d,this._getLabelLocale(t)),r.addClass(g.Strings.toCssClass(T)),x&&x.toLowerCase()==="license"&&A.exec(t.value[0].value)!==null)n=this._buildMetadataItemURIValue(t.value[0].value),E.append(n);else if(this._data.showAllLanguages&&t.value&&t.value.length>1)for(var O=0;O<t.value.length;O++){var C=t.value[O];n=this._buildMetadataItemValue(C.value,C.locale),E.append(n)}else{var I=this._getValueLocale(t),f=!1;for(O=0;O<t.value.length;O++){var C=t.value[O];I.toLowerCase()===C.locale.toLowerCase()&&(f=!0,n=this._buildMetadataItemValue(C.value,C.locale),E.append(n))}f||(C=t.value[0])&&(n=this._buildMetadataItemValue(C.value,C.locale),E.append(n))}this._data.copyToClipboardEnabled&&g.Clipboard.supportsCopy()&&d.text()&&this._addCopyButton(r,d,E);var _=this;return r.on("click","a.iiif-viewer-link",function(y){y.preventDefault();var S=$(y.target),L=S.attr("data-uv-navigate")||S.prop("href");_.fire(p.IIIF_VIEWER_LINK_CLICKED,L)}),r.on("click","[data-uv-navigate]",function(y){y.preventDefault();var S=$(y.target).attr("data-uv-navigate")||null;S&&_.fire(p.IIIF_VIEWER_LINK_CLICKED,S)}),r},e.prototype._getLabelLocale=function(t){if(!this._data||!this._data.helper)return"";var n=this._data.helper.options.locale;if(t.label.length){var r=t.label[0].locale;if(r.toLowerCase()!==n.toLowerCase())return r}return n},e.prototype._getValueLocale=function(t){return this._data&&this._data.helper?this._data.helper.options.locale:""},e.prototype._buildMetadataItemValue=function(t,n){t=(t=this._sanitize(t)).replace(`
`,"<br>");var r=this._$metadataItemValueTemplate.clone();return r.html(t),r.find("a").each(function(){var d=$(this);d.hasClass("iiif-viewer-link")||d.prop("target","_blank")}),n&&this._addReadingDirection(r,n),r},e.prototype._buildMetadataItemURIValue=function(t){t=this._sanitize(t);var n=this._$metadataItemURIValueTemplate.clone();return n.prop("href",t),n.text(t),n},e.prototype._addReadingDirection=function(t,n){n=o.Utils.getInexactLocale(n),this._readCSV(this._data.rtlLanguageCodes).filter(function(r){return r===n}).length>0&&(t.prop("dir","rtl"),t.addClass("rtl"))},e.prototype._addCopyButton=function(t,n,r){var d=this._$copyTextTemplate.clone(),E=d.children();n.append(d),g.Device.isTouch()?d.show():(t.on("mouseenter",function(){d.show()}),t.on("mouseleave",function(){d.hide()}),d.on("mouseleave",function(){E.hide()}));var x=this,T=r.text();d.on("click",function(A){x._copyItemValues(d,T)})},e.prototype._copyItemValues=function(t,n){g.Clipboard.copy(n);var r=t.find(".copiedText");r.show(),setTimeout(function(){r.hide()},this._data.copiedMessageDuration)},e.prototype._readCSV=function(t,n){n===void 0&&(n=!0);var r=[];if(t&&(r=t.split(","),n))for(var d=0;d<r.length;d++)r[d]=this._normalise(r[d]);return r},e.prototype._sanitize=function(t){return this._data.sanitizer?this._data.sanitizer(t):null},e.prototype._resize=function(){},e}(v.BaseComponent);i.MetadataComponent=l;var p=function(){function h(){}return h.IIIF_VIEWER_LINK_CLICKED="iiifViewerLinkClicked",h}();i.Events=p},function(s,i,a){s.exports=function(u){var c={};function m(o){if(c[o])return c[o].exports;var v=c[o]={i:o,l:!1,exports:{}};return u[o].call(v.exports,v,v.exports,m),v.l=!0,v.exports}return m.m=u,m.c=c,m.d=function(o,v,g){m.o(o,v)||Object.defineProperty(o,v,{enumerable:!0,get:g})},m.r=function(o){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(o,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(o,"__esModule",{value:!0})},m.t=function(o,v){if(1&v&&(o=m(o)),8&v||4&v&&typeof o=="object"&&o&&o.__esModule)return o;var g=Object.create(null);if(m.r(g),Object.defineProperty(g,"default",{enumerable:!0,value:o}),2&v&&typeof o!="string")for(var l in o)m.d(g,l,function(p){return o[p]}.bind(null,l));return g},m.n=function(o){var v=o&&o.__esModule?function(){return o.default}:function(){return o};return m.d(v,"a",v),v},m.o=function(o,v){return Object.prototype.hasOwnProperty.call(o,v)},m.p="",m(m.s=4)}([function(u,c,m){"use strict";function o(v){for(var g in v)c.hasOwnProperty(g)||(c[g]=v[g])}Object.defineProperty(c,"__esModule",{value:!0}),o(m(6)),o(m(7)),o(m(8)),o(m(9)),o(m(10)),o(m(11)),o(m(12)),o(m(13)),o(m(14)),o(m(15)),o(m(16)),o(m(17)),o(m(18)),o(m(19)),o(m(20)),o(m(21)),o(m(22)),o(m(23)),o(m(24)),o(m(25)),o(m(26)),o(m(27)),o(m(28)),o(m(29)),o(m(30)),o(m(31)),o(m(32)),o(m(2))},function(u,c,m){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),function(o){o.BOOKMARKING="oa:bookmarking",o.CLASSIFYING="oa:classifying",o.COMMENTING="oa:commenting",o.DESCRIBING="oa:describing",o.EDITING="oa:editing",o.HIGHLIGHTING="oa:highlighting",o.IDENTIFYING="oa:identifying",o.LINKING="oa:linking",o.MODERATING="oa:moderating",o.PAINTING="sc:painting",o.QUESTIONING="oa:questioning",o.REPLYING="oa:replying",o.TAGGING="oa:tagging",o.TRANSCRIBING="oad:transcribing"}(c.AnnotationMotivation||(c.AnnotationMotivation={})),function(o){o.AUTO_ADVANCE="auto-advance",o.CONTINUOUS="continuous",o.FACING_PAGES="facing-pages",o.HIDDEN="hidden",o.INDIVIDUALS="individuals",o.MULTI_PART="multi-part",o.NO_NAV="no-nav",o.NON_PAGED="non-paged",o.PAGED="paged",o.REPEAT="repeat",o.SEQUENCE="sequence",o.THUMBNAIL_NAV="thumbnail-nav",o.TOGETHER="together",o.UNORDERED="unordered"}(c.Behavior||(c.Behavior={})),function(o){o.CANVAS="canvas",o.CHOICE="choice",o.CONTENT_AS_TEXT="contentastext",o.DOCUMENT="document",o.IMAGE="image",o.MOVING_IMAGE="movingimage",o.PDF="pdf",o.PHYSICAL_OBJECT="physicalobject",o.SOUND="sound",o.TEXTUALBODY="textualbody",o.VIDEO="video"}(c.ExternalResourceType||(c.ExternalResourceType={})),function(o){o.ANNOTATION="annotation",o.CANVAS="canvas",o.COLLECTION="collection",o.MANIFEST="manifest",o.RANGE="range",o.SEQUENCE="sequence"}(c.IIIFResourceType||(c.IIIFResourceType={})),function(o){o.AUDIO_MP4="audio/mp4",o.CORTO="application/corto",o.DRACO="application/draco",o.GLTF="model/gltf+json",o.JPG="image/jpeg",o.M3U8="application/vnd.apple.mpegurl",o.MP3="audio/mp3",o.MPEG_DASH="application/dash+xml",o.OBJ="text/plain",o.PDF="application/pdf",o.PLY="application/ply",o.THREEJS="application/vnd.threejs+json",o.VIDEO_MP4="video/mp4",o.WEBM="video/webm"}(c.MediaType||(c.MediaType={})),function(o){o.DOC="application/msword",o.DOCX="application/vnd.openxmlformats-officedocument.wordprocessingml.document",o.PDF="application/pdf"}(c.RenderingFormat||(c.RenderingFormat={})),function(o){o.IMAGE_0_COMPLIANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/compliance.html#level0",o.IMAGE_0_COMPLIANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/compliance.html#level1",o.IMAGE_0_COMPLIANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/compliance.html#level2",o.IMAGE_0_CONFORMANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/conformance.html#level0",o.IMAGE_0_CONFORMANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/conformance.html#level1",o.IMAGE_0_CONFORMANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/conformance.html#level2",o.IMAGE_1_COMPLIANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level0",o.IMAGE_1_COMPLIANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level1",o.IMAGE_1_COMPLIANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level2",o.IMAGE_1_CONFORMANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level0",o.IMAGE_1_CONFORMANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level1",o.IMAGE_1_CONFORMANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level2",o.IMAGE_1_LEVEL_0="http://iiif.io/api/image/1/level0.json",o.IMAGE_1_PROFILE_LEVEL_0="http://iiif.io/api/image/1/profiles/level0.json",o.IMAGE_1_LEVEL_1="http://iiif.io/api/image/1/level1.json",o.IMAGE_1_PROFILE_LEVEL_1="http://iiif.io/api/image/1/profiles/level1.json",o.IMAGE_1_LEVEL_2="http://iiif.io/api/image/1/level2.json",o.IMAGE_1_PROFILE_LEVEL_2="http://iiif.io/api/image/1/profiles/level2.json",o.IMAGE_2_LEVEL_0="http://iiif.io/api/image/2/level0.json",o.IMAGE_2_PROFILE_LEVEL_0="http://iiif.io/api/image/2/profiles/level0.json",o.IMAGE_2_LEVEL_1="http://iiif.io/api/image/2/level1.json",o.IMAGE_2_PROFILE_LEVEL_1="http://iiif.io/api/image/2/profiles/level1.json",o.IMAGE_2_LEVEL_2="http://iiif.io/api/image/2/level2.json",o.IMAGE_2_PROFILE_LEVEL_2="http://iiif.io/api/image/2/profiles/level2.json",o.AUTH_0_CLICK_THROUGH="http://iiif.io/api/auth/0/login/clickthrough",o.AUTH_0_LOGIN="http://iiif.io/api/auth/0/login",o.AUTH_0_LOGOUT="http://iiif.io/api/auth/0/logout",o.AUTH_0_RESTRICTED="http://iiif.io/api/auth/0/login/restricted",o.AUTH_0_TOKEN="http://iiif.io/api/auth/0/token",o.AUTH_1_CLICK_THROUGH="http://iiif.io/api/auth/1/clickthrough",o.AUTH_1_EXTERNAL="http://iiif.io/api/auth/1/external",o.AUTH_1_KIOSK="http://iiif.io/api/auth/1/kiosk",o.AUTH_1_LOGIN="http://iiif.io/api/auth/1/login",o.AUTH_1_LOGOUT="http://iiif.io/api/auth/1/logout",o.AUTH_1_PROBE="http://iiif.io/api/auth/1/probe",o.AUTH_1_TOKEN="http://iiif.io/api/auth/1/token",o.SEARCH_0="http://iiif.io/api/search/0/search",o.SEARCH_0_AUTO_COMPLETE="http://iiif.io/api/search/0/autocomplete",o.SEARCH_1="http://iiif.io/api/search/1/search",o.SEARCH_1_AUTO_COMPLETE="http://iiif.io/api/search/1/autocomplete",o.TRACKING_EXTENSIONS="http://universalviewer.io/tracking-extensions-profile",o.UI_EXTENSIONS="http://universalviewer.io/ui-extensions-profile",o.PRINT_EXTENSIONS="http://universalviewer.io/print-extensions-profile",o.SHARE_EXTENSIONS="http://universalviewer.io/share-extensions-profile",o.OTHER_MANIFESTATIONS="http://iiif.io/api/otherManifestations.json",o.IXIF="http://wellcomelibrary.org/ld/ixif/0/alpha.json"}(c.ServiceProfile||(c.ServiceProfile={})),function(o){o.BOTTOM_TO_TOP="bottom-to-top",o.LEFT_TO_RIGHT="left-to-right",o.RIGHT_TO_LEFT="right-to-left",o.TOP_TO_BOTTOM="top-to-bottom"}(c.ViewingDirection||(c.ViewingDirection={})),function(o){o.CONTINUOUS="continuous",o.INDIVIDUALS="individuals",o.NON_PAGED="non-paged",o.PAGED="paged",o.TOP="top"}(c.ViewingHint||(c.ViewingHint={}))},function(u,c,m){"use strict";var o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(d,E){function x(O){try{A(r.next(O))}catch(C){E(C)}}function T(O){try{A(r.throw(O))}catch(C){E(C)}}function A(O){var C;O.done?d(O.value):(C=O.value,C instanceof n?C:new n(function(I){I(C)})).then(x,T)}A((r=r.apply(e,t||[])).next())})},v=this&&this.__generator||function(e,t){var n,r,d,E,x={label:0,sent:function(){if(1&d[0])throw d[1];return d[1]},trys:[],ops:[]};return E={next:T(0),throw:T(1),return:T(2)},typeof Symbol=="function"&&(E[Symbol.iterator]=function(){return this}),E;function T(A){return function(O){return function(C){if(n)throw new TypeError("Generator is already executing.");for(;x;)try{if(n=1,r&&(d=2&C[0]?r.return:C[0]?r.throw||((d=r.return)&&d.call(r),0):r.next)&&!(d=d.call(r,C[1])).done)return d;switch(r=0,d&&(C=[2&C[0],d.value]),C[0]){case 0:case 1:d=C;break;case 4:return x.label++,{value:C[1],done:!1};case 5:x.label++,r=C[1],C=[0];continue;case 7:C=x.ops.pop(),x.trys.pop();continue;default:if(!(d=(d=x.trys).length>0&&d[d.length-1])&&(C[0]===6||C[0]===2)){x=0;continue}if(C[0]===3&&(!d||C[1]>d[0]&&C[1]<d[3])){x.label=C[1];break}if(C[0]===6&&x.label<d[1]){x.label=d[1],d=C;break}if(d&&x.label<d[2]){x.label=d[2],x.ops.push(C);break}d[2]&&x.ops.pop(),x.trys.pop();continue}C=t.call(e,x)}catch(I){C=[6,I],r=0}finally{n=d=0}if(5&C[0])throw C[1];return{value:C[0]?C[1]:void 0,done:!0}}([A,O])}}};Object.defineProperty(c,"__esModule",{value:!0});var g=m(0),l=m(1),p=m(33);m(34);var h=function(){function e(){}return e.getMediaType=function(t){return(t=(t=t.toLowerCase()).split(";")[0]).trim()},e.getImageQuality=function(t){return t===l.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_1||t===l.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_2||t===l.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_1||t===l.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_2||t===l.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_1||t===l.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_2||t===l.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_1||t===l.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_2||t===l.ServiceProfile.IMAGE_1_LEVEL_1||t===l.ServiceProfile.IMAGE_1_PROFILE_LEVEL_1||t===l.ServiceProfile.IMAGE_1_LEVEL_2||t===l.ServiceProfile.IMAGE_1_PROFILE_LEVEL_2?"native":"default"},e.getInexactLocale=function(t){return t.indexOf("-")!==-1?t.substr(0,t.indexOf("-")):t},e.getLocalisedValue=function(t,n){if(!Array.isArray(t))return t;for(var r=0;r<t.length;r++){var d=t[r];if(n===d["@language"])return d["@value"]}var E=n.substr(0,n.indexOf("-"));for(r=0;r<t.length;r++){var x=t[r];if(x["@language"]===E)return x["@value"]}return null},e.generateTreeNodeIds=function(t,n){var r;n===void 0&&(n=0),r=t.parentNode?t.parentNode.id+"-"+n:"0",t.id=r;for(var d=0;d<t.nodes.length;d++){var E=t.nodes[d];e.generateTreeNodeIds(E,d)}},e.normaliseType=function(t){return(t=t.toLowerCase()).indexOf(":")!==-1?t.split(":")[1]:t},e.normaliseUrl=function(t){return(t=t.substr(t.indexOf("://"))).indexOf("#")!==-1&&(t=t.split("#")[0]),t},e.normalisedUrlsMatch=function(t,n){return e.normaliseUrl(t)===e.normaliseUrl(n)},e.isImageProfile=function(t){return!!(e.normalisedUrlsMatch(t,l.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_0)||e.normalisedUrlsMatch(t,l.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_1)||e.normalisedUrlsMatch(t,l.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_2)||e.normalisedUrlsMatch(t,l.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_0)||e.normalisedUrlsMatch(t,l.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_2)||e.normalisedUrlsMatch(t,l.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_0)||e.normalisedUrlsMatch(t,l.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_1)||e.normalisedUrlsMatch(t,l.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_2)||e.normalisedUrlsMatch(t,l.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_1)||e.normalisedUrlsMatch(t,l.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_2)||e.normalisedUrlsMatch(t,l.ServiceProfile.IMAGE_1_LEVEL_0)||e.normalisedUrlsMatch(t,l.ServiceProfile.IMAGE_1_PROFILE_LEVEL_0)||e.normalisedUrlsMatch(t,l.ServiceProfile.IMAGE_1_LEVEL_1)||e.normalisedUrlsMatch(t,l.ServiceProfile.IMAGE_1_PROFILE_LEVEL_1)||e.normalisedUrlsMatch(t,l.ServiceProfile.IMAGE_1_LEVEL_2)||e.normalisedUrlsMatch(t,l.ServiceProfile.IMAGE_1_PROFILE_LEVEL_2)||e.normalisedUrlsMatch(t,l.ServiceProfile.IMAGE_2_LEVEL_0)||e.normalisedUrlsMatch(t,l.ServiceProfile.IMAGE_2_PROFILE_LEVEL_0)||e.normalisedUrlsMatch(t,l.ServiceProfile.IMAGE_2_LEVEL_1)||e.normalisedUrlsMatch(t,l.ServiceProfile.IMAGE_2_PROFILE_LEVEL_1)||e.normalisedUrlsMatch(t,l.ServiceProfile.IMAGE_2_LEVEL_2)||e.normalisedUrlsMatch(t,l.ServiceProfile.IMAGE_2_PROFILE_LEVEL_2))},e.isLevel0ImageProfile=function(t){return!!(e.normalisedUrlsMatch(t,l.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_0)||e.normalisedUrlsMatch(t,l.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_0)||e.normalisedUrlsMatch(t,l.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_0)||e.normalisedUrlsMatch(t,l.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_0)||e.normalisedUrlsMatch(t,l.ServiceProfile.IMAGE_1_LEVEL_0)||e.normalisedUrlsMatch(t,l.ServiceProfile.IMAGE_1_PROFILE_LEVEL_0)||e.normalisedUrlsMatch(t,l.ServiceProfile.IMAGE_2_LEVEL_0)||e.normalisedUrlsMatch(t,l.ServiceProfile.IMAGE_2_PROFILE_LEVEL_0))},e.isLevel1ImageProfile=function(t){return!!(e.normalisedUrlsMatch(t,l.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_1)||e.normalisedUrlsMatch(t,l.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_1)||e.normalisedUrlsMatch(t,l.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_1)||e.normalisedUrlsMatch(t,l.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_1)||e.normalisedUrlsMatch(t,l.ServiceProfile.IMAGE_1_LEVEL_1)||e.normalisedUrlsMatch(t,l.ServiceProfile.IMAGE_1_PROFILE_LEVEL_1)||e.normalisedUrlsMatch(t,l.ServiceProfile.IMAGE_2_LEVEL_1)||e.normalisedUrlsMatch(t,l.ServiceProfile.IMAGE_2_PROFILE_LEVEL_1))},e.isLevel2ImageProfile=function(t){return!!(e.normalisedUrlsMatch(t,l.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_2)||e.normalisedUrlsMatch(t,l.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_2)||e.normalisedUrlsMatch(t,l.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_2)||e.normalisedUrlsMatch(t,l.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_2)||e.normalisedUrlsMatch(t,l.ServiceProfile.IMAGE_1_LEVEL_2)||e.normalisedUrlsMatch(t,l.ServiceProfile.IMAGE_1_PROFILE_LEVEL_2)||e.normalisedUrlsMatch(t,l.ServiceProfile.IMAGE_2_LEVEL_2)||e.normalisedUrlsMatch(t,l.ServiceProfile.IMAGE_2_PROFILE_LEVEL_2))},e.parseManifest=function(t,n){return g.Deserialiser.parse(t,n)},e.checkStatus=function(t){if(t.ok)return t;var n=new Error(t.statusText);return n.response=t,Promise.reject(n)},e.loadManifest=function(t){return new Promise(function(n){fetch(t).then(e.checkStatus).then(function(r){return r.json()}).then(function(r){n(r)})})},e.loadExternalResourcesAuth1=function(t,n,r,d,E,x,T,A){return new Promise(function(O,C){var I=t.map(function(f){return e.loadExternalResourceAuth1(f,n,r,d,E,x,T,A)});Promise.all(I).then(function(){O(t)}).catch(function(f){C(f)})})},e.loadExternalResourceAuth1=function(t,n,r,d,E,x,T,A){return o(this,void 0,void 0,function(){var O;return v(this,function(C){switch(C.label){case 0:return[4,d(t)];case 1:return(O=C.sent())?[4,t.getData(O)]:[3,6];case 2:return C.sent(),t.status!==p.OK?[3,3]:[2,t];case 3:return[4,e.doAuthChain(t,n,r,E,x,T,A)];case 4:C.sent(),C.label=5;case 5:if(t.status===p.OK||t.status===p.MOVED_TEMPORARILY)return[2,t];throw e.createAuthorizationFailedError();case 6:return[4,t.getData()];case 7:return C.sent(),t.status!==p.MOVED_TEMPORARILY&&t.status!==p.UNAUTHORIZED?[3,9]:[4,e.doAuthChain(t,n,r,E,x,T,A)];case 8:C.sent(),C.label=9;case 9:if(t.status===p.OK||t.status===p.MOVED_TEMPORARILY)return[2,t];throw e.createAuthorizationFailedError()}})})},e.doAuthChain=function(t,n,r,d,E,x,T){return o(this,void 0,void 0,function(){var A,O,C,I,f,_,y,S;return v(this,function(L){switch(L.label){case 0:return t.isAccessControlled()?((A=t.externalService)&&(A.options=t.options),(O=t.kioskService)&&(O.options=t.options),(C=t.clickThroughService)&&(C.options=t.options),(I=t.loginService)&&(I.options=t.options),t.isResponseHandled||t.status!==p.MOVED_TEMPORARILY?[3,2]:[4,x(t)]):[2,t];case 1:return L.sent(),[2,t];case 2:return f=null,_=null,(f=A)?(_=f,[4,e.attemptResourceWithToken(t,r,f)]):[3,4];case 3:return L.sent(),[2,t];case 4:return(f=O)?(_=f,(y=n(f))?[4,d(y)]:[3,7]):[3,7];case 5:return L.sent(),[4,e.attemptResourceWithToken(t,r,f)];case 6:return L.sent(),[2,t];case 7:return(f=C)?(_=f,[4,E(t,f)]):[3,11];case 8:return(S=L.sent())?[4,d(S)]:[3,11];case 9:return L.sent(),[4,e.attemptResourceWithToken(t,r,f)];case 10:return L.sent(),[2,t];case 11:return(f=I)?(_=f,[4,E(t,f)]):[3,15];case 12:return(S=L.sent())?[4,d(S)]:[3,15];case 13:return L.sent(),[4,e.attemptResourceWithToken(t,r,f)];case 14:return L.sent(),[2,t];case 15:return _&&T(t,_),[2]}})})},e.attemptResourceWithToken=function(t,n,r){return o(this,void 0,void 0,function(){var d,E;return v(this,function(x){switch(x.label){case 0:return(d=r.getService(l.ServiceProfile.AUTH_1_TOKEN))?[4,n(t,d)]:[3,3];case 1:return(E=x.sent())&&E.accessToken?[4,t.getData(E)]:[3,3];case 2:return x.sent(),[2,t];case 3:return[2]}})})},e.loadExternalResourcesAuth09=function(t,n,r,d,E,x,T,A,O,C){return new Promise(function(I,f){var _=t.map(function(y){return e.loadExternalResourceAuth09(y,n,r,d,E,x,T,A,O,C)});Promise.all(_).then(function(){I(t)}).catch(function(y){f(y)})})},e.loadExternalResourceAuth09=function(t,n,r,d,E,x,T,A,O,C){return new Promise(function(I,f){C&&C.pessimisticAccessControl?t.getData().then(function(){t.isAccessControlled()?t.clickThroughService?(I(r(t)),I(d(t))):E(t).then(function(){x(t,!0).then(function(_){t.getData(_).then(function(){I(O(t))}).catch(function(y){f(e.createInternalServerError(y))})}).catch(function(_){f(e.createInternalServerError(_))})}).catch(function(_){f(e.createInternalServerError(_))}):I(t)}).catch(function(_){f(e.createInternalServerError(_))}):A(t,n).then(function(_){_?t.getData(_).then(function(){t.status===p.OK?I(O(t)):e.authorize(t,n,r,d,E,x,T,A).then(function(){I(O(t))}).catch(function(y){f(e.createAuthorizationFailedError())})}).catch(function(y){f(e.createAuthorizationFailedError())}):e.authorize(t,n,r,d,E,x,T,A).then(function(){I(O(t))}).catch(function(y){f(e.createAuthorizationFailedError())})}).catch(function(_){f(e.createAuthorizationFailedError())})})},e.createError=function(t,n){var r=new Error;return r.message=n,r.name=String(t),r},e.createAuthorizationFailedError=function(){return e.createError(g.StatusCode.AUTHORIZATION_FAILED,"Authorization failed")},e.createRestrictedError=function(){return e.createError(g.StatusCode.RESTRICTED,"Restricted")},e.createInternalServerError=function(t){return e.createError(g.StatusCode.INTERNAL_SERVER_ERROR,t)},e.authorize=function(t,n,r,d,E,x,T,A){return new Promise(function(O,C){t.getData().then(function(){t.isAccessControlled()?A(t,n).then(function(I){I?t.getData(I).then(function(){t.status===p.OK?O(t):e.showAuthInteraction(t,n,r,d,E,x,T,O,C)}).catch(function(f){C(e.createInternalServerError(f))}):x(t,!1).then(function(f){f?T(t,f,n).then(function(){t.getData(f).then(function(){t.status===p.OK?O(t):e.showAuthInteraction(t,n,r,d,E,x,T,O,C)}).catch(function(_){C(e.createInternalServerError(_))})}).catch(function(_){C(e.createInternalServerError(_))}):e.showAuthInteraction(t,n,r,d,E,x,T,O,C)})}).catch(function(I){C(e.createInternalServerError(I))}):O(t)})})},e.showAuthInteraction=function(t,n,r,d,E,x,T,A,O){t.status!==p.MOVED_TEMPORARILY||t.isResponseHandled?t.clickThroughService&&!t.isResponseHandled?r(t).then(function(){x(t,!0).then(function(C){T(t,C,n).then(function(){t.getData(C).then(function(){A(t)}).catch(function(I){O(e.createInternalServerError(I))})}).catch(function(I){O(e.createInternalServerError(I))})}).catch(function(C){O(e.createInternalServerError(C))})}):E(t).then(function(){x(t,!0).then(function(C){T(t,C,n).then(function(){t.getData(C).then(function(){A(t)}).catch(function(I){O(e.createInternalServerError(I))})}).catch(function(I){O(e.createInternalServerError(I))})}).catch(function(C){O(e.createInternalServerError(C))})}):A(t)},e.getService=function(t,n){for(var r=this.getServices(t),d=0;d<r.length;d++){var E=r[d];if(E.getProfile()===n)return E}return null},e.getResourceById=function(t,n){return e.traverseAndFind(t.__jsonld,"@id",n)},e.traverseAndFind=function(t,n,r){if(t.hasOwnProperty(n)&&t[n]===r)return t;for(var d=0;d<Object.keys(t).length;d++)if(typeof t[Object.keys(t)[d]]=="object"){var E=e.traverseAndFind(t[Object.keys(t)[d]],n,r);if(E!=null)return E}},e.getServices=function(t){var n,r=[];if(!(n=t.__jsonld?t.__jsonld.service:t.service))return r;Array.isArray(n)||(n=[n]);for(var d=0;d<n.length;d++){var E=n[d];if(typeof E=="string"){var x=this.getResourceById(t.options.resource,E);x&&r.push(new g.Service(x.__jsonld||x,t.options))}else r.push(new g.Service(E,t.options))}return r},e.getTemporalComponent=function(t){var n=/t=([^&]+)/g.exec(t),r=null;return n&&n[1]&&(r=n[1].split(",")),r},e}();c.Utils=h},function(u,c,m){"use strict";m.r(c),c.default=function(o,v){return v=v||{},new Promise(function(g,l){var p=new XMLHttpRequest,h=[],e=[],t={},n=function(){return{ok:(p.status/100|0)==2,statusText:p.statusText,status:p.status,url:p.responseURL,text:function(){return Promise.resolve(p.responseText)},json:function(){return Promise.resolve(JSON.parse(p.responseText))},blob:function(){return Promise.resolve(new Blob([p.response]))},clone:n,headers:{keys:function(){return h},entries:function(){return e},get:function(d){return t[d.toLowerCase()]},has:function(d){return d.toLowerCase()in t}}}};for(var r in p.open(v.method||"get",o,!0),p.onload=function(){p.getAllResponseHeaders().replace(/^(.*?):[^\S\n]*([\s\S]*?)$/gm,function(d,E,x){h.push(E=E.toLowerCase()),e.push([E,x]),t[E]=t[E]?t[E]+","+x:x}),g(n())},p.onerror=l,p.withCredentials=v.credentials=="include",v.headers)p.setRequestHeader(r,v.headers[r]);p.send(v.body||null)})}},function(u,c,m){u.exports=m(5)},function(u,c,m){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),function(v){for(var g in v)c.hasOwnProperty(g)||(c[g]=v[g])}(m(0));var o=m(2);c.loadManifest=function(v){return o.Utils.loadManifest(v)},c.parseManifest=function(v,g){return o.Utils.parseManifest(v,g)}},function(u,c,m){"use strict";Object.defineProperty(c,"__esModule",{value:!0});var o=function(){function v(g){this.__jsonld=g,this.context=this.getProperty("context"),this.id=this.getProperty("id")}return v.prototype.getProperty=function(g){var l=null;return this.__jsonld&&((l=this.__jsonld[g])||(l=this.__jsonld["@"+g])),l},v}();c.JSONLDResource=o},function(u,c,m){"use strict";var o,v=this&&this.__extends||(o=function(h,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)n.hasOwnProperty(r)&&(t[r]=n[r])})(h,e)},function(h,e){function t(){this.constructor=h}o(h,e),h.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)});Object.defineProperty(c,"__esModule",{value:!0});var g=m(0),l=m(1),p=function(h){function e(t,n){var r=h.call(this,t)||this;return r.options=n,r}return v(e,h),e.prototype.getIIIFResourceType=function(){return g.Utils.normaliseType(this.getProperty("type"))},e.prototype.getLabel=function(){var t=this.getProperty("label");return t?g.LanguageMap.parse(t,this.options.locale):[]},e.prototype.getDefaultLabel=function(){return g.LanguageMap.getValue(this.getLabel())},e.prototype.getMetadata=function(){var t=this.getProperty("metadata"),n=[];if(!t)return n;for(var r=0;r<t.length;r++){var d=t[r],E=new g.LabelValuePair(this.options.locale);E.parse(d),n.push(E)}return n},e.prototype.getRendering=function(t){for(var n=this.getRenderings(),r=0;r<n.length;r++){var d=n[r];if(d.getFormat()===t)return d}return null},e.prototype.getRenderings=function(){var t,n=[];if(!(t=this.__jsonld?this.__jsonld.rendering:this.rendering))return n;Array.isArray(t)||(t=[t]);for(var r=0;r<t.length;r++){var d=t[r];n.push(new g.Rendering(d,this.options))}return n},e.prototype.getService=function(t){return g.Utils.getService(this,t)},e.prototype.getServices=function(){return g.Utils.getServices(this)},e.prototype.getThumbnail=function(){var t=this.getProperty("thumbnail");return Array.isArray(t)&&(t=t[0]),t?new g.Thumbnail(t,this.options):null},e.prototype.isAnnotation=function(){return this.getIIIFResourceType()===l.IIIFResourceType.ANNOTATION},e.prototype.isCanvas=function(){return this.getIIIFResourceType()===l.IIIFResourceType.CANVAS},e.prototype.isCollection=function(){return this.getIIIFResourceType()===l.IIIFResourceType.COLLECTION},e.prototype.isManifest=function(){return this.getIIIFResourceType()===l.IIIFResourceType.MANIFEST},e.prototype.isRange=function(){return this.getIIIFResourceType()===l.IIIFResourceType.RANGE},e.prototype.isSequence=function(){return this.getIIIFResourceType()===l.IIIFResourceType.SEQUENCE},e}(g.JSONLDResource);c.ManifestResource=p},function(u,c,m){"use strict";var o,v=this&&this.__extends||(o=function(p,h){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(p,h)},function(p,h){function e(){this.constructor=p}o(p,h),p.prototype=h===null?Object.create(h):(e.prototype=h.prototype,new e)});Object.defineProperty(c,"__esModule",{value:!0});var g=m(0),l=function(p){function h(e,t){return p.call(this,e,t)||this}return v(h,p),h.prototype.getFormat=function(){var e=this.getProperty("format");return e?e.toLowerCase():null},h.prototype.getResources=function(){var e=[];if(!this.__jsonld.resources)return e;for(var t=0;t<this.__jsonld.resources.length;t++){var n=this.__jsonld.resources[t],r=new g.Annotation(n,this.options);e.push(r)}return e},h.prototype.getType=function(){var e=this.getProperty("type");return e?g.Utils.normaliseType(e):null},h.prototype.getWidth=function(){return this.getProperty("width")},h.prototype.getHeight=function(){return this.getProperty("height")},h.prototype.getMaxWidth=function(){return this.getProperty("maxWidth")},h.prototype.getMaxHeight=function(){return this.getProperty("maxHeight")?null:this.getMaxWidth()},h}(g.ManifestResource);c.Resource=l},function(u,c,m){"use strict";var o,v=this&&this.__extends||(o=function(h,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)n.hasOwnProperty(r)&&(t[r]=n[r])})(h,e)},function(h,e){function t(){this.constructor=h}o(h,e),h.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)});Object.defineProperty(c,"__esModule",{value:!0});var g=m(0),l=m(1),p=function(h){function e(t,n){var r=h.call(this,t,n)||this;r.index=-1,r.isLoaded=!1;var d={defaultLabel:"-",locale:"en-GB",resource:r,pessimisticAccessControl:!1};return r.options=Object.assign(d,n),r}return v(e,h),e.prototype.getAttribution=function(){var t=this.getProperty("attribution");return t?g.LanguageMap.parse(t,this.options.locale):[]},e.prototype.getDescription=function(){var t=this.getProperty("description");return t?g.LanguageMap.parse(t,this.options.locale):[]},e.prototype.getIIIFResourceType=function(){return g.Utils.normaliseType(this.getProperty("type"))},e.prototype.getLogo=function(){var t=this.getProperty("logo");return t?typeof t=="string"?t:(Array.isArray(t)&&t.length&&(t=t[0]),t["@id"]||t.id):null},e.prototype.getLicense=function(){return g.Utils.getLocalisedValue(this.getProperty("license"),this.options.locale)},e.prototype.getNavDate=function(){return new Date(this.getProperty("navDate"))},e.prototype.getRelated=function(){return this.getProperty("related")},e.prototype.getSeeAlso=function(){return this.getProperty("seeAlso")},e.prototype.getTrackingLabel=function(){var t=this.getService(l.ServiceProfile.TRACKING_EXTENSIONS);return t?t.getProperty("trackingLabel"):""},e.prototype.getDefaultTree=function(){return this.defaultTree=new g.TreeNode("root"),this.defaultTree.data=this,this.defaultTree},e.prototype.getRequiredStatement=function(){var t=null,n=this.getProperty("requiredStatement");if(n)(t=new g.LabelValuePair(this.options.locale)).parse(n);else{var r=this.getAttribution();r&&((t=new g.LabelValuePair(this.options.locale)).value=r)}return t},e.prototype.isCollection=function(){return this.getIIIFResourceType()===l.IIIFResourceType.COLLECTION},e.prototype.isManifest=function(){return this.getIIIFResourceType()===l.IIIFResourceType.MANIFEST},e.prototype.load=function(){var t=this;return new Promise(function(n){if(t.isLoaded)n(t);else{var r=t.options;r.navDate=t.getNavDate();var d=t.__jsonld.id;d||(d=t.__jsonld["@id"]),g.Utils.loadManifest(d).then(function(E){t.parentLabel=g.LanguageMap.getValue(t.getLabel(),r.locale);var x=g.Deserialiser.parse(E,r);(t=Object.assign(t,x)).index=r.index,n(t)})}})},e}(g.ManifestResource);c.IIIFResource=p},function(u,c,m){"use strict";var o,v=this&&this.__extends||(o=function(p,h){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(p,h)},function(p,h){function e(){this.constructor=p}o(p,h),p.prototype=h===null?Object.create(h):(e.prototype=h.prototype,new e)});Object.defineProperty(c,"__esModule",{value:!0});var g=m(0),l=function(p){function h(e,t){return p.call(this,e,t)||this}return v(h,p),h.prototype.getBody=function(){var e=[],t=this.getProperty("body");if(t)if(Array.isArray(t))for(var n=0;n<t.length;n++)if((E=t[n]).items)for(var r=0;r<E.items.length;r++){var d=E.items[r];e.push(new g.AnnotationBody(d,this.options))}else e.push(new g.AnnotationBody(E,this.options));else if(t.items)for(n=0;n<t.items.length;n++){var E=t.items[n];e.push(new g.AnnotationBody(E,this.options))}else e.push(new g.AnnotationBody(t,this.options));return e},h.prototype.getMotivation=function(){return this.getProperty("motivation")||null},h.prototype.getOn=function(){return this.getProperty("on")},h.prototype.getTarget=function(){return this.getProperty("target")},h.prototype.getResource=function(){return new g.Resource(this.getProperty("resource"),this.options)},h}(g.ManifestResource);c.Annotation=l},function(u,c,m){"use strict";var o,v=this&&this.__extends||(o=function(p,h){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(p,h)},function(p,h){function e(){this.constructor=p}o(p,h),p.prototype=h===null?Object.create(h):(e.prototype=h.prototype,new e)});Object.defineProperty(c,"__esModule",{value:!0});var g=m(0),l=function(p){function h(e,t){return p.call(this,e,t)||this}return v(h,p),h.prototype.getFormat=function(){var e=this.getProperty("format");return e?g.Utils.getMediaType(e):null},h.prototype.getType=function(){return this.getProperty("type")?g.Utils.normaliseType(this.getProperty("type")):null},h.prototype.getWidth=function(){return this.getProperty("width")},h.prototype.getHeight=function(){return this.getProperty("height")},h}(g.ManifestResource);c.AnnotationBody=l},function(u,c,m){"use strict";var o,v=this&&this.__extends||(o=function(p,h){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(p,h)},function(p,h){function e(){this.constructor=p}o(p,h),p.prototype=h===null?Object.create(h):(e.prototype=h.prototype,new e)});Object.defineProperty(c,"__esModule",{value:!0});var g=m(0),l=function(p){function h(e,t,n){var r=p.call(this,t)||this;return r.label=e,r.options=n,r}return v(h,p),h.prototype.getIIIFResourceType=function(){return g.Utils.normaliseType(this.getProperty("type"))},h.prototype.getLabel=function(){return this.label},h.prototype.getResources=function(){var e=this;return this.getProperty("resources").map(function(t){return new g.Annotation(t,e.options)})},h.prototype.load=function(){var e=this;return new Promise(function(t,n){if(e.isLoaded)t(e);else{var r=e.__jsonld.id;r||(r=e.__jsonld["@id"]),g.Utils.loadManifest(r).then(function(d){e.__jsonld=d,e.context=e.getProperty("context"),e.id=e.getProperty("id"),e.isLoaded=!0,t(e)}).catch(n)}})},h}(g.JSONLDResource);c.AnnotationList=l},function(u,c,m){"use strict";var o,v=this&&this.__extends||(o=function(l,p){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,e){h.__proto__=e}||function(h,e){for(var t in e)e.hasOwnProperty(t)&&(h[t]=e[t])})(l,p)},function(l,p){function h(){this.constructor=l}o(l,p),l.prototype=p===null?Object.create(p):(h.prototype=p.prototype,new h)});Object.defineProperty(c,"__esModule",{value:!0});var g=function(l){function p(h,e){return l.call(this,h,e)||this}return v(p,l),p.prototype.getItems=function(){return this.getProperty("items")},p}(m(0).ManifestResource);c.AnnotationPage=g},function(u,c,m){"use strict";var o,v=this&&this.__extends||(o=function(p,h){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(p,h)},function(p,h){function e(){this.constructor=p}o(p,h),p.prototype=h===null?Object.create(h):(e.prototype=h.prototype,new e)});Object.defineProperty(c,"__esModule",{value:!0});var g=m(0),l=function(p){function h(e,t){return p.call(this,e,t)||this}return v(h,p),h.prototype.getCanonicalImageUri=function(e){var t,n=null,r="default",d=e;if(this.externalResource&&this.externalResource.data&&this.externalResource.data["@id"])n=this.externalResource.data["@id"],d||(d=this.externalResource.data.width),this.externalResource.data["@context"]&&(this.externalResource.data["@context"].indexOf("/1.0/context.json")>-1||this.externalResource.data["@context"].indexOf("/1.1/context.json")>-1||this.externalResource.data["@context"].indexOf("/1/context.json")>-1)&&(r="native");else{var E=this.getImages();if(E&&E.length){var x=E[0].getResource(),T=x.getServices();if(d||(d=x.getWidth()),T.length){var A=T[0];n=A.id,r=g.Utils.getImageQuality(A.getProfile())}else if(d===x.getWidth())return x.id}if(!n){var O=this.getProperty("thumbnail");if(O){if(typeof O=="string")return O;if(O["@id"])return O["@id"];if(O.length)return O[0].id}}}return t=d+",",n&&n.endsWith("/")&&(n=n.substr(0,n.length-1)),[n,"full",t,0,r+".jpg"].join("/")},h.prototype.getMaxDimensions=function(){var e,t=null;return this.externalResource&&this.externalResource.data&&this.externalResource.data.profile&&(e=this.externalResource.data.profile,Array.isArray(e)&&(e=e.filter(function(n){return n.maxWidth})[0])&&(t=new g.Size(e.maxWidth,e.maxHeight?e.maxHeight:e.maxWidth))),t},h.prototype.getContent=function(){var e=[],t=this.__jsonld.items||this.__jsonld.content;if(!t)return e;var n=null;if(t.length&&(n=new g.AnnotationPage(t[0],this.options)),!n)return e;for(var r=n.getItems(),d=0;d<r.length;d++){var E=r[d],x=new g.Annotation(E,this.options);e.push(x)}return e},h.prototype.getDuration=function(){return this.getProperty("duration")},h.prototype.getImages=function(){var e=[];if(!this.__jsonld.images)return e;for(var t=0;t<this.__jsonld.images.length;t++){var n=this.__jsonld.images[t],r=new g.Annotation(n,this.options);e.push(r)}return e},h.prototype.getIndex=function(){return this.getProperty("index")},h.prototype.getOtherContent=function(){var e=this,t=(Array.isArray(this.getProperty("otherContent"))?this.getProperty("otherContent"):[this.getProperty("otherContent")]).filter(function(n){return n&&typeof(r=n["@type"])=="string"&&r.toLowerCase()==r.toLowerCase();var r}).map(function(n,r){return new g.AnnotationList(n.label||"Annotation list "+r,n,e.options)}).map(function(n){return n.load()});return Promise.all(t)},h.prototype.getWidth=function(){return this.getProperty("width")},h.prototype.getHeight=function(){return this.getProperty("height")},h}(g.Resource);c.Canvas=l},function(u,c,m){"use strict";var o,v=this&&this.__extends||(o=function(h,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)n.hasOwnProperty(r)&&(t[r]=n[r])})(h,e)},function(h,e){function t(){this.constructor=h}o(h,e),h.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)});Object.defineProperty(c,"__esModule",{value:!0});var g=m(1),l=m(0),p=function(h){function e(t,n){var r=h.call(this,t,n)||this;return r.items=[],r._collections=null,r._manifests=null,t.__collection=r,r}return v(e,h),e.prototype.getCollections=function(){return this._collections?this._collections:this._collections=this.items.filter(function(t){return t.isCollection()})},e.prototype.getManifests=function(){return this._manifests?this._manifests:this._manifests=this.items.filter(function(t){return t.isManifest()})},e.prototype.getCollectionByIndex=function(t){for(var n,r=this.getCollections(),d=0;d<r.length;d++){var E=r[d];E.index===t&&(n=E)}if(n)return n.options.index=t,n.load();throw new Error("Collection index not found")},e.prototype.getManifestByIndex=function(t){for(var n,r=this.getManifests(),d=0;d<r.length;d++){var E=r[d];E.index===t&&(n=E)}if(n)return n.options.index=t,n.load();throw new Error("Manifest index not found")},e.prototype.getTotalCollections=function(){return this.getCollections().length},e.prototype.getTotalManifests=function(){return this.getManifests().length},e.prototype.getTotalItems=function(){return this.items.length},e.prototype.getViewingDirection=function(){return this.getProperty("viewingDirection")?this.getProperty("viewingDirection"):g.ViewingDirection.LEFT_TO_RIGHT},e.prototype.getDefaultTree=function(){return h.prototype.getDefaultTree.call(this),this.defaultTree.data.type=l.Utils.normaliseType(l.TreeNodeType.COLLECTION),this._parseManifests(this),this._parseCollections(this),l.Utils.generateTreeNodeIds(this.defaultTree),this.defaultTree},e.prototype._parseManifests=function(t){if(t.getManifests()&&t.getManifests().length)for(var n=0;n<t.getManifests().length;n++){var r=t.getManifests()[n],d=r.getDefaultTree();d.label=r.parentLabel||l.LanguageMap.getValue(r.getLabel(),this.options.locale)||"manifest "+(n+1),d.navDate=r.getNavDate(),d.data.id=r.id,d.data.type=l.Utils.normaliseType(l.TreeNodeType.MANIFEST),t.defaultTree.addNode(d)}},e.prototype._parseCollections=function(t){if(t.getCollections()&&t.getCollections().length)for(var n=0;n<t.getCollections().length;n++){var r=t.getCollections()[n],d=r.getDefaultTree();d.label=r.parentLabel||l.LanguageMap.getValue(r.getLabel(),this.options.locale)||"collection "+(n+1),d.navDate=r.getNavDate(),d.data.id=r.id,d.data.type=l.Utils.normaliseType(l.TreeNodeType.COLLECTION),t.defaultTree.addNode(d)}},e}(l.IIIFResource);c.Collection=p},function(u,c,m){"use strict";Object.defineProperty(c,"__esModule",{value:!0});var o=function(){function v(g,l){this.start=g,this.end=l}return v.prototype.getLength=function(){return this.end-this.start},v}();c.Duration=o},function(u,c,m){"use strict";Object.defineProperty(c,"__esModule",{value:!0});var o=m(0),v=function(){function g(l){this.defaultLocale=l}return g.prototype.parse=function(l){this.resource=l,this.label=o.LanguageMap.parse(this.resource.label,this.defaultLocale),this.value=o.LanguageMap.parse(this.resource.value,this.defaultLocale)},g.prototype.getLabel=function(){return this.label?o.LanguageMap.getValue(this.label,this.defaultLocale):null},g.prototype.setLabel=function(l){var p=this;if(this.label&&this.label.length){var h=this.label.filter(function(e){return e.locale===p.defaultLocale||e.locale===o.Utils.getInexactLocale(p.defaultLocale)})[0];h&&(h.value=l)}},g.prototype.getValue=function(){if(this.value){var l=this.defaultLocale;return this.label&&this.label.length&&this.label[0].locale&&(l=this.label[0].locale),o.LanguageMap.getValue(this.value,l)}return null},g.prototype.setValue=function(l){var p=this;if(this.value&&this.value.length){var h=this.value.filter(function(e){return e.locale===p.defaultLocale||e.locale===o.Utils.getInexactLocale(p.defaultLocale)})[0];h&&(h.value=l)}},g}();c.LabelValuePair=v},function(u,c,m){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.Language=function(o,v){Array.isArray(o)?o.length===1?this.value=o[0]:this.value=o.join("<br/>"):this.value=o,this.locale=v}},function(u,c,m){"use strict";var o,v=this&&this.__extends||(o=function(p,h){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(p,h)},function(p,h){function e(){this.constructor=p}o(p,h),p.prototype=h===null?Object.create(h):(e.prototype=h.prototype,new e)});Object.defineProperty(c,"__esModule",{value:!0});var g=m(0),l=function(p){function h(){return p!==null&&p.apply(this,arguments)||this}return v(h,p),h.parse=function(e,t){var n,r=[];if(!e)return r;if(Array.isArray(e))for(var d=0;d<e.length;d++){var E=e[d];n=typeof E=="string"?new g.Language(E,t):new g.Language(E["@value"],E["@language"]||t),r.push(n)}else{if(typeof e=="string")return n=new g.Language(e,t),r.push(n),r;e["@value"]?(n=new g.Language(e["@value"],e["@language"]||t),r.push(n)):Object.keys(e).forEach(function(x){if(!e[x].length)throw new Error("language must have a value");n=new g.Language(e[x],x),r.push(n)})}return r},h.getValue=function(e,t){if(e.length){if(t){var n=e.filter(function(r){return r.locale===t||g.Utils.getInexactLocale(r.locale)===g.Utils.getInexactLocale(t)})[0];if(n)return n.value}return e[0].value}return null},h}(Array);c.LanguageMap=l},function(u,c,m){"use strict";var o,v=this&&this.__extends||(o=function(h,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)n.hasOwnProperty(r)&&(t[r]=n[r])})(h,e)},function(h,e){function t(){this.constructor=h}o(h,e),h.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)});Object.defineProperty(c,"__esModule",{value:!0});var g=m(1),l=m(0),p=function(h){function e(t,n){var r=h.call(this,t,n)||this;if(r.index=0,r._allRanges=null,r.items=[],r._topRanges=[],r.__jsonld.structures&&r.__jsonld.structures.length)for(var d=r._getTopRanges(),E=0;E<d.length;E++){var x=d[E];r._parseRanges(x,String(E))}return r}return v(e,h),e.prototype.getPosterCanvas=function(){var t=this.getProperty("posterCanvas");return t&&(t=new l.Canvas(t,this.options)),t},e.prototype.getBehavior=function(){var t=this.getProperty("behavior");return Array.isArray(t)&&(t=t[0]),t||null},e.prototype.getDefaultTree=function(){if(h.prototype.getDefaultTree.call(this),this.defaultTree.data.type=l.Utils.normaliseType(l.TreeNodeType.MANIFEST),!this.isLoaded)return this.defaultTree;var t=this.getTopRanges();return t.length&&t[0].getTree(this.defaultTree),l.Utils.generateTreeNodeIds(this.defaultTree),this.defaultTree},e.prototype._getTopRanges=function(){var t=[];if(this.__jsonld.structures&&this.__jsonld.structures.length){for(var n=0;n<this.__jsonld.structures.length;n++){var r=this.__jsonld.structures[n];r.viewingHint===g.ViewingHint.TOP&&t.push(r)}if(!t.length){var d={};d.ranges=this.__jsonld.structures,t.push(d)}}return t},e.prototype.getTopRanges=function(){return this._topRanges},e.prototype._getRangeById=function(t){if(this.__jsonld.structures&&this.__jsonld.structures.length)for(var n=0;n<this.__jsonld.structures.length;n++){var r=this.__jsonld.structures[n];if(r["@id"]===t||r.id===t)return r}return null},e.prototype._parseRanges=function(t,n,r){var d,E=null;if(typeof t=="string"&&(E=t,t=this._getRangeById(E)),t){(d=new l.Range(t,this.options)).parentRange=r,d.path=n,r?r.items.push(d):this._topRanges.push(d);var x=t.items||t.members;if(x)for(var T=0;T<x.length;T++){var A=x[T];if(A["@type"]&&A["@type"].toLowerCase()==="sc:range"||A.type&&A.type.toLowerCase()==="range")this._parseRanges(A,n+"/"+T,d);else if(A["@type"]&&A["@type"].toLowerCase()==="sc:canvas"||A.type&&A.type.toLowerCase()==="canvas"){d.canvases||(d.canvases=[]);var O=A.id||A["@id"];d.canvases.push(O)}}else if(t.ranges)for(T=0;T<t.ranges.length;T++)this._parseRanges(t.ranges[T],n+"/"+T,d)}else console.warn("Range:",E,"does not exist")},e.prototype.getAllRanges=function(){if(this._allRanges!=null)return this._allRanges;this._allRanges=[];for(var t=this.getTopRanges(),n=function(E){var x=t[E];x.id&&r._allRanges.push(x);var T=function(O,C){O.add(C);var I=C.getRanges();return I.length?I.reduce(T,O):O},A=Array.from(x.getRanges().reduce(T,new Set));r._allRanges=r._allRanges.concat(A)},r=this,d=0;d<t.length;d++)n(d);return this._allRanges},e.prototype.getRangeById=function(t){for(var n=this.getAllRanges(),r=0;r<n.length;r++){var d=n[r];if(d.id===t)return d}return null},e.prototype.getRangeByPath=function(t){for(var n=this.getAllRanges(),r=0;r<n.length;r++){var d=n[r];if(d.path===t)return d}return null},e.prototype.getSequences=function(){if(this.items.length)return this.items;var t=this.__jsonld.mediaSequences||this.__jsonld.sequences;if(t)for(var n=0;n<t.length;n++){var r=t[n],d=new l.Sequence(r,this.options);this.items.push(d)}else this.__jsonld.items&&(d=new l.Sequence(this.__jsonld.items,this.options),this.items.push(d));return this.items},e.prototype.getSequenceByIndex=function(t){return this.getSequences()[t]},e.prototype.getTotalSequences=function(){return this.getSequences().length},e.prototype.getManifestType=function(){var t=this.getService(g.ServiceProfile.UI_EXTENSIONS);return t?t.getProperty("manifestType"):l.ManifestType.EMPTY},e.prototype.isMultiSequence=function(){return this.getTotalSequences()>1},e.prototype.isPagingEnabled=function(){var t=this.getViewingHint();if(t)return t===g.ViewingHint.PAGED;var n=this.getBehavior();return!!n&&n===g.Behavior.PAGED},e.prototype.getViewingDirection=function(){return this.getProperty("viewingDirection")},e.prototype.getViewingHint=function(){return this.getProperty("viewingHint")},e}(l.IIIFResource);c.Manifest=p},function(u,c,m){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),function(o){o.EMPTY="",o.MANUSCRIPT="manuscript",o.MONOGRAPH="monograph"}(c.ManifestType||(c.ManifestType={}))},function(u,c,m){"use strict";var o,v=this&&this.__extends||(o=function(h,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)n.hasOwnProperty(r)&&(t[r]=n[r])})(h,e)},function(h,e){function t(){this.constructor=h}o(h,e),h.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)});Object.defineProperty(c,"__esModule",{value:!0});var g=m(0),l=m(1),p=function(h){function e(t,n){var r=h.call(this,t,n)||this;return r._ranges=null,r.canvases=null,r.items=[],r}return v(e,h),e.prototype.getCanvasIds=function(){return this.__jsonld.canvases?this.__jsonld.canvases:this.canvases?this.canvases:[]},e.prototype.getDuration=function(){var t,n;if(this.canvases&&this.canvases.length)for(var r=0;r<this.canvases.length;r++){var d=this.canvases[r],E=g.Utils.getTemporalComponent(d);E&&E.length>1&&(r===0&&(t=Number(E[0])),r===this.canvases.length-1&&(n=Number(E[1])))}else{var x=this.getRanges();for(r=0;r<x.length;r++){var T=x[r].getDuration();T&&(r===0&&(t=T.start),r===x.length-1&&(n=T.end))}}if(t!==void 0&&n!==void 0)return new g.Duration(t,n)},e.prototype.getRanges=function(){return this._ranges?this._ranges:this._ranges=this.items.filter(function(t){return t.isRange()})},e.prototype.getBehavior=function(){var t=this.getProperty("behavior");return Array.isArray(t)&&(t=t[0]),t||null},e.prototype.getViewingDirection=function(){return this.getProperty("viewingDirection")},e.prototype.getViewingHint=function(){return this.getProperty("viewingHint")},e.prototype.getTree=function(t){t.data=this,this.treeNode=t;var n=this.getRanges();if(n&&n.length)for(var r=0;r<n.length;r++){var d=n[r],E=new g.TreeNode;t.addNode(E),this._parseTreeNode(E,d)}return g.Utils.generateTreeNodeIds(t),t},e.prototype.spansTime=function(t){var n=this.getDuration();return!!(n&&t>=n.start&&t<=n.end)},e.prototype._parseTreeNode=function(t,n){t.label=g.LanguageMap.getValue(n.getLabel(),this.options.locale),t.data=n,t.data.type=g.Utils.normaliseType(g.TreeNodeType.RANGE),n.treeNode=t;var r=n.getRanges();if(r&&r.length)for(var d=0;d<r.length;d++){var E=r[d];if(E.getBehavior()!==l.Behavior.NO_NAV){var x=new g.TreeNode;t.addNode(x),this._parseTreeNode(x,E)}}},e}(g.ManifestResource);c.Range=p},function(u,c,m){"use strict";var o,v=this&&this.__extends||(o=function(l,p){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,e){h.__proto__=e}||function(h,e){for(var t in e)e.hasOwnProperty(t)&&(h[t]=e[t])})(l,p)},function(l,p){function h(){this.constructor=l}o(l,p),l.prototype=p===null?Object.create(p):(h.prototype=p.prototype,new h)});Object.defineProperty(c,"__esModule",{value:!0});var g=function(l){function p(h,e){return l.call(this,h,e)||this}return v(p,l),p.prototype.getFormat=function(){return this.getProperty("format")},p}(m(0).ManifestResource);c.Rendering=g},function(u,c,m){"use strict";var o,v=this&&this.__extends||(o=function(h,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)n.hasOwnProperty(r)&&(t[r]=n[r])})(h,e)},function(h,e){function t(){this.constructor=h}o(h,e),h.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)});Object.defineProperty(c,"__esModule",{value:!0});var g=m(1),l=m(0),p=function(h){function e(t,n){var r=h.call(this,t,n)||this;return r.items=[],r._thumbnails=null,r}return v(e,h),e.prototype.getCanvases=function(){if(this.items.length)return this.items;var t=this.__jsonld.canvases||this.__jsonld.elements;if(t)for(var n=0;n<t.length;n++){var r=t[n];(d=new l.Canvas(r,this.options)).index=n,this.items.push(d)}else if(this.__jsonld)for(n=0;n<this.__jsonld.length;n++){var d;r=this.__jsonld[n],(d=new l.Canvas(r,this.options)).index=n,this.items.push(d)}return this.items},e.prototype.getCanvasById=function(t){for(var n=0;n<this.getTotalCanvases();n++){var r=this.getCanvasByIndex(n),d=l.Utils.normaliseUrl(r.id);if(l.Utils.normaliseUrl(t)===d)return r}return null},e.prototype.getCanvasByIndex=function(t){return this.getCanvases()[t]},e.prototype.getCanvasIndexById=function(t){for(var n=0;n<this.getTotalCanvases();n++)if(this.getCanvasByIndex(n).id===t)return n;return null},e.prototype.getCanvasIndexByLabel=function(t,n){t=t.trim(),isNaN(t)||(t=parseInt(t,10).toString(),n&&(t+="r"));for(var r,d,E,x=/(\d*)\D+(\d*)/,T=0;T<this.getTotalCanvases();T++){var A=this.getCanvasByIndex(T);if(l.LanguageMap.getValue(A.getLabel(),this.options.locale)===t||(r=x.exec(t))&&(d=r[1],(E=r[2])&&new RegExp("^"+d+"\\D+"+E+"$").test(A.getLabel().toString())))return T}return-1},e.prototype.getLastCanvasLabel=function(t){for(var n=this.getTotalCanvases()-1;n>=0;n--){var r=this.getCanvasByIndex(n),d=l.LanguageMap.getValue(r.getLabel(),this.options.locale);if(t){if(/^[a-zA-Z0-9]*$/.test(d))return d}else if(d)return d}return this.options.defaultLabel},e.prototype.getLastPageIndex=function(){return this.getTotalCanvases()-1},e.prototype.getNextPageIndex=function(t,n){var r;if(n){var d=this.getPagedIndices(t),E=this.getViewingDirection();r=E&&E===g.ViewingDirection.RIGHT_TO_LEFT?d[0]+1:d[d.length-1]+1}else r=t+1;return r>this.getLastPageIndex()?-1:r},e.prototype.getPagedIndices=function(t,n){var r=[];if(n){r=this.isFirstCanvas(t)||this.isLastCanvas(t)?[t]:t%2?[t,t+1]:[t-1,t];var d=this.getViewingDirection();d&&d===g.ViewingDirection.RIGHT_TO_LEFT&&(r=r.reverse())}else r.push(t);return r},e.prototype.getPrevPageIndex=function(t,n){var r;if(n){var d=this.getPagedIndices(t),E=this.getViewingDirection();r=E&&E===g.ViewingDirection.RIGHT_TO_LEFT?d[d.length-1]-1:d[0]-1}else r=t-1;return r},e.prototype.getStartCanvasIndex=function(){var t=this.getStartCanvas();if(t){for(var n=0;n<this.getTotalCanvases();n++)if(this.getCanvasByIndex(n).id===t)return n}return 0},e.prototype.getThumbs=function(t,n){for(var r=[],d=this.getTotalCanvases(),E=0;E<d;E++){var x=this.getCanvasByIndex(E),T=new l.Thumb(t,x);r.push(T)}return r},e.prototype.getThumbnails=function(){if(this._thumbnails!=null)return this._thumbnails;this._thumbnails=[];for(var t=this.getCanvases(),n=0;n<t.length;n++){var r=t[n].getThumbnail();r&&this._thumbnails.push(r)}return this._thumbnails},e.prototype.getStartCanvas=function(){return this.getProperty("startCanvas")},e.prototype.getTotalCanvases=function(){return this.getCanvases().length},e.prototype.getViewingDirection=function(){return this.getProperty("viewingDirection")?this.getProperty("viewingDirection"):this.options.resource.getViewingDirection?this.options.resource.getViewingDirection():null},e.prototype.getViewingHint=function(){return this.getProperty("viewingHint")},e.prototype.isCanvasIndexOutOfRange=function(t){return t>this.getTotalCanvases()-1},e.prototype.isFirstCanvas=function(t){return t===0},e.prototype.isLastCanvas=function(t){return t===this.getTotalCanvases()-1},e.prototype.isMultiCanvas=function(){return this.getTotalCanvases()>1},e.prototype.isPagingEnabled=function(){var t=this.getViewingHint();return!!t&&t===g.ViewingHint.PAGED},e.prototype.isTotalCanvasesEven=function(){return this.getTotalCanvases()%2==0},e}(l.ManifestResource);c.Sequence=p},function(u,c,m){"use strict";Object.defineProperty(c,"__esModule",{value:!0});var o=m(0),v=function(){function g(){}return g.parse=function(l,p){return typeof l=="string"&&(l=JSON.parse(l)),this.parseJson(l,p)},g.parseJson=function(l,p){var h;if(p&&p.navDate&&!isNaN(p.navDate.getTime())&&(l.navDate=p.navDate.toString()),l["@type"])switch(l["@type"]){case"sc:Collection":h=this.parseCollection(l,p);break;case"sc:Manifest":h=this.parseManifest(l,p);break;default:return null}else switch(l.type){case"Collection":h=this.parseCollection(l,p);break;case"Manifest":h=this.parseManifest(l,p);break;default:return null}return h.isLoaded=!0,h},g.parseCollection=function(l,p){var h=new o.Collection(l,p);return p?(h.index=p.index||0,p.resource&&(h.parentCollection=p.resource.parentCollection)):h.index=0,this.parseCollections(h,p),this.parseManifests(h,p),this.parseItems(h,p),h},g.parseCollections=function(l,p){var h;if(l.__jsonld.collections?h=l.__jsonld.collections:l.__jsonld.items&&(h=l.__jsonld.items.filter(function(n){return n.type.toLowerCase()==="collection"})),h)for(var e=0;e<h.length;e++){p&&(p.index=e);var t=this.parseCollection(h[e],p);t.index=e,t.parentCollection=l,l.items.push(t)}},g.parseManifest=function(l,p){return new o.Manifest(l,p)},g.parseManifests=function(l,p){var h;if(l.__jsonld.manifests?h=l.__jsonld.manifests:l.__jsonld.items&&(h=l.__jsonld.items.filter(function(n){return n.type.toLowerCase()==="manifest"})),h)for(var e=0;e<h.length;e++){var t=this.parseManifest(h[e],p);t.index=e,t.parentCollection=l,l.items.push(t)}},g.parseItem=function(l,p){if(l["@type"]){if(l["@type"].toLowerCase()==="sc:manifest")return this.parseManifest(l,p);if(l["@type"].toLowerCase()==="sc:collection")return this.parseCollection(l,p)}else if(l.type){if(l.type.toLowerCase()==="manifest")return this.parseManifest(l,p);if(l.type.toLowerCase()==="collection")return this.parseCollection(l,p)}return null},g.parseItems=function(l,p){var h=l.__jsonld.members||l.__jsonld.items;if(h)for(var e=function(d){p&&(p.index=d);var E=t.parseItem(h[d],p);return E?l.items.filter(function(x){return x.id===E.id})[0]?"continue":(E.index=d,E.parentCollection=l,void l.items.push(E)):{value:void 0}},t=this,n=0;n<h.length;n++){var r=e(n);if(typeof r=="object")return r.value}},g}();c.Deserialiser=v},function(u,c,m){"use strict";var o,v=this&&this.__extends||(o=function(p,h){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(p,h)},function(p,h){function e(){this.constructor=p}o(p,h),p.prototype=h===null?Object.create(h):(e.prototype=h.prototype,new e)});Object.defineProperty(c,"__esModule",{value:!0});var g=m(0),l=function(p){function h(e,t){return p.call(this,e,t)||this}return v(h,p),h.prototype.getProfile=function(){var e=this.getProperty("profile");return e||(e=this.getProperty("dcterms:conformsTo")),Array.isArray(e)?e[0]:e},h.prototype.getConfirmLabel=function(){return g.Utils.getLocalisedValue(this.getProperty("confirmLabel"),this.options.locale)},h.prototype.getDescription=function(){return g.Utils.getLocalisedValue(this.getProperty("description"),this.options.locale)},h.prototype.getFailureDescription=function(){return g.Utils.getLocalisedValue(this.getProperty("failureDescription"),this.options.locale)},h.prototype.getFailureHeader=function(){return g.Utils.getLocalisedValue(this.getProperty("failureHeader"),this.options.locale)},h.prototype.getHeader=function(){return g.Utils.getLocalisedValue(this.getProperty("header"),this.options.locale)},h.prototype.getServiceLabel=function(){return g.Utils.getLocalisedValue(this.getProperty("label"),this.options.locale)},h.prototype.getInfoUri=function(){var e=this.id;return e.endsWith("/")||(e+="/"),e+"info.json"},h}(g.ManifestResource);c.Service=l},function(u,c,m){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.Size=function(o,v){this.width=o,this.height=v}},function(u,c,m){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),function(o){o[o.AUTHORIZATION_FAILED=1]="AUTHORIZATION_FAILED",o[o.FORBIDDEN=2]="FORBIDDEN",o[o.INTERNAL_SERVER_ERROR=3]="INTERNAL_SERVER_ERROR",o[o.RESTRICTED=4]="RESTRICTED"}(c.StatusCode||(c.StatusCode={}))},function(u,c,m){"use strict";Object.defineProperty(c,"__esModule",{value:!0});var o=m(0);c.Thumb=function(v,g){this.data=g,this.index=g.index,this.width=v;var l=g.getHeight()/g.getWidth();this.height=l?Math.floor(this.width*l):v,this.uri=g.getCanonicalImageUri(v),this.label=o.LanguageMap.getValue(g.getLabel())}},function(u,c,m){"use strict";var o,v=this&&this.__extends||(o=function(l,p){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,e){h.__proto__=e}||function(h,e){for(var t in e)e.hasOwnProperty(t)&&(h[t]=e[t])})(l,p)},function(l,p){function h(){this.constructor=l}o(l,p),l.prototype=p===null?Object.create(p):(h.prototype=p.prototype,new h)});Object.defineProperty(c,"__esModule",{value:!0});var g=function(l){function p(h,e){return l.call(this,h,e)||this}return v(p,l),p}(m(0).Resource);c.Thumbnail=g},function(u,c,m){"use strict";Object.defineProperty(c,"__esModule",{value:!0});var o=m(0),v=function(){function g(l,p){this.label=l,this.data=p||{},this.nodes=[]}return g.prototype.addNode=function(l){this.nodes.push(l),l.parentNode=this},g.prototype.isCollection=function(){return this.data.type===o.Utils.normaliseType(o.TreeNodeType.COLLECTION)},g.prototype.isManifest=function(){return this.data.type===o.Utils.normaliseType(o.TreeNodeType.MANIFEST)},g.prototype.isRange=function(){return this.data.type===o.Utils.normaliseType(o.TreeNodeType.RANGE)},g}();c.TreeNode=v},function(u,c,m){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),function(o){o.COLLECTION="collection",o.MANIFEST="manifest",o.RANGE="range"}(c.TreeNodeType||(c.TreeNodeType={}))},function(u,c,m){u.exports=function(o){var v={};function g(l){if(v[l])return v[l].exports;var p=v[l]={i:l,l:!1,exports:{}};return o[l].call(p.exports,p,p.exports,g),p.l=!0,p.exports}return g.m=o,g.c=v,g.d=function(l,p,h){g.o(l,p)||Object.defineProperty(l,p,{enumerable:!0,get:h})},g.r=function(l){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(l,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(l,"__esModule",{value:!0})},g.t=function(l,p){if(1&p&&(l=g(l)),8&p||4&p&&typeof l=="object"&&l&&l.__esModule)return l;var h=Object.create(null);if(g.r(h),Object.defineProperty(h,"default",{enumerable:!0,value:l}),2&p&&typeof l!="string")for(var e in l)g.d(h,e,function(t){return l[t]}.bind(null,e));return h},g.n=function(l){var p=l&&l.__esModule?function(){return l.default}:function(){return l};return g.d(p,"a",p),p},g.o=function(l,p){return Object.prototype.hasOwnProperty.call(l,p)},g.p="",g(g.s=0)}([function(o,v,g){o.exports=g(1)},function(o,v,g){"use strict";Object.defineProperty(v,"__esModule",{value:!0}),v.CONTINUE=100,v.SWITCHING_PROTOCOLS=101,v.PROCESSING=102,v.OK=200,v.CREATED=201,v.ACCEPTED=202,v.NON_AUTHORITATIVE_INFORMATION=203,v.NO_CONTENT=204,v.RESET_CONTENT=205,v.PARTIAL_CONTENT=206,v.MULTI_STATUS=207,v.MULTIPLE_CHOICES=300,v.MOVED_PERMANENTLY=301,v.MOVED_TEMPORARILY=302,v.SEE_OTHER=303,v.NOT_MODIFIED=304,v.USE_PROXY=305,v.TEMPORARY_REDIRECT=307,v.BAD_REQUEST=400,v.UNAUTHORIZED=401,v.PAYMENT_REQUIRED=402,v.FORBIDDEN=403,v.NOT_FOUND=404,v.METHOD_NOT_ALLOWED=405,v.NOT_ACCEPTABLE=406,v.PROXY_AUTHENTICATION_REQUIRED=407,v.REQUEST_TIME_OUT=408,v.CONFLICT=409,v.GONE=410,v.LENGTH_REQUIRED=411,v.PRECONDITION_FAILED=412,v.REQUEST_ENTITY_TOO_LARGE=413,v.REQUEST_URI_TOO_LARGE=414,v.UNSUPPORTED_MEDIA_TYPE=415,v.REQUESTED_RANGE_NOT_SATISFIABLE=416,v.EXPECTATION_FAILED=417,v.IM_A_TEAPOT=418,v.UNPROCESSABLE_ENTITY=422,v.LOCKED=423,v.FAILED_DEPENDENCY=424,v.UNORDERED_COLLECTION=425,v.UPGRADE_REQUIRED=426,v.PRECONDITION_REQUIRED=428,v.TOO_MANY_REQUESTS=429,v.REQUEST_HEADER_FIELDS_TOO_LARGE=431,v.INTERNAL_SERVER_ERROR=500,v.NOT_IMPLEMENTED=501,v.BAD_GATEWAY=502,v.SERVICE_UNAVAILABLE=503,v.GATEWAY_TIME_OUT=504,v.HTTP_VERSION_NOT_SUPPORTED=505,v.VARIANT_ALSO_NEGOTIATES=506,v.INSUFFICIENT_STORAGE=507,v.BANDWIDTH_LIMIT_EXCEEDED=509,v.NOT_EXTENDED=510,v.NETWORK_AUTHENTICATION_REQUIRED=511}])},function(u,c,m){u.exports=window.fetch||(window.fetch=m(3).default||m(3))}])},function(s,i,a){"use strict";a.r(i),a.d(i,"BaseComponent",function(){return u});var u=function(){function c(m){this.options=m,this.options.data=Object.assign({},this.data(),m.data)}return c.prototype._init=function(){return this.el=this.options.target,this.el?(this.el.innerHTML="",!0):(console.warn("element not found"),!1)},c.prototype.data=function(){return{}},c.prototype.on=function(m,o,v){var g=this._e||(this._e={});(g[m]||(g[m]=[])).push({fn:o,ctx:v})},c.prototype.fire=function(m){for(var o=[],v=1;v<arguments.length;v++)o[v-1]=arguments[v];for(var g=[].slice.call(arguments,1),l=((this._e||(this._e={}))[m]||[]).slice(),p=0,h=l.length;p<h;p++)l[p].fn.apply(l[p].ctx,g)},c.prototype._resize=function(){},c.prototype.set=function(m){},c}()},function(s,i,a){"use strict";a.r(i),a.d(i,"Async",function(){return c}),a.d(i,"Bools",function(){return m}),a.d(i,"Clipboard",function(){return o}),a.d(i,"Colors",function(){return v}),a.d(i,"Dates",function(){return g}),a.d(i,"Device",function(){return l}),a.d(i,"Documents",function(){return p}),a.d(i,"Events",function(){return h}),a.d(i,"Files",function(){return e}),a.d(i,"Keyboard",function(){return t}),a.d(i,"Maths",function(){return n}),a.d(i,"Size",function(){return r}),a.d(i,"Dimensions",function(){return d}),a.d(i,"Numbers",function(){return E}),a.d(i,"Objects",function(){return x}),a.d(i,"Storage",function(){return T}),a.d(i,"StorageItem",function(){return A}),a.d(i,"StorageType",function(){return u}),a.d(i,"Strings",function(){return O}),a.d(i,"Urls",function(){return C});var u,c=function(){function I(){}return I.waitFor=function(f,_,y,S,L,P){S||(S=200),L||(L=100),P||(P=0),(P+=1)>L?y&&y():f()?_():setTimeout(function(){I.waitFor(f,_,y,S,L,P)},S)},I}(),m=function(){function I(){}return I.getBool=function(f,_){return f??_},I}(),o=function(){function I(){}return I.supportsCopy=function(){return document.queryCommandSupported&&document.queryCommandSupported("copy")},I.copy=function(f){f=I.convertBrToNewLine(f);var _=document.createElement("textarea");_.value=f,I.hideButKeepEnabled(_),document.body.appendChild(_),_.focus(),_.select(),document.execCommand("copy"),document.body.removeChild(_)},I.hideButKeepEnabled=function(f){f.style.position="fixed",f.style.top="0",f.style.left="0",f.style.width="2em",f.style.height="2em",f.style.padding="0",f.style.border="none",f.style.outline="none",f.style.boxShadow="none",f.style.background="transparent"},I.convertBrToNewLine=function(f){return f=f.replace(/<br\s*[\/]?>/gi,`
`)},I}(),v=function(){function I(){}return I.float32ColorToARGB=function(f){return[(4278190080&f)>>>24,(16711680&f)>>>16,(65280&f)>>>8,255&f]},I._componentToHex=function(f){var _=f.toString(16);return _.length==1?"0"+_:_},I.rgbToHexString=function(f){return I.coalesce(f),"#"+I._componentToHex(f[0])+I._componentToHex(f[1])+I._componentToHex(f[2])},I.argbToHexString=function(f){return"#"+I._componentToHex(f[0])+I._componentToHex(f[1])+I._componentToHex(f[2])+I._componentToHex(f[3])},I.coalesce=function(f){for(var _=1;_<f.length;_++)f[_]===void 0&&(f[_]=f[_-1])},I}(),g=function(){function I(){}return I.getTimeStamp=function(){return new Date().getTime()},I}(),l=function(){function I(){}return I.getPixelRatio=function(f){return(window.devicePixelRatio||1)/(f.webkitBackingStorePixelRatio||f.mozBackingStorePixelRatio||f.msBackingStorePixelRatio||f.oBackingStorePixelRatio||f.backingStorePixelRatio||1)},I.isTouch=function(){return"ontouchstart"in window||window.navigator.msMaxTouchPoints>0},I}(),p=function(){function I(){}return I.isInIFrame=function(){try{return window.self!==window.top}catch{return!0}},I.supportsFullscreen=function(){var f=document.documentElement;return(f.requestFullscreen||f.mozRequestFullScreen||f.webkitRequestFullScreen||f.msRequestFullscreen)!==void 0},I.isHidden=function(){return!!I.getHiddenProp()},I.getHiddenProp=function(){var f=["webkit","moz","ms","o"];if("hidden"in document)return"hidden";for(var _=0;_<f.length;_++)if(f[_]+"Hidden"in document)return f[_]+"Hidden";return null},I}(),h=function(){function I(){}return I.debounce=function(f,_){return _=_||100,function(){if(!f.debouncing){var y=Array.prototype.slice.apply(arguments);f.lastReturnVal=f.apply(window,y),f.debouncing=!0}return clearTimeout(f.debounceTimeout),f.debounceTimeout=setTimeout(function(){f.debouncing=!1},_),f.lastReturnVal}},I}(),e=function(){function I(){}return I.simplifyMimeType=function(f){switch(f){case"text/plain":return"txt";case"image/jpeg":return"jpg";case"application/msword":return"doc";case"application/vnd.openxmlformats-officedocument.wordprocessingml.document":return"docx";default:var _=f.split("/");return _[_.length-1]}},I}(),t=function(){function I(){}return I.getCharCode=function(f){return typeof f.which=="number"?f.which:f.keyCode},I}(),n=function(){function I(){}return I.normalise=function(f,_,y){return(f-_)/(y-_)},I.median=function(f){f.sort(function(y,S){return y-S});var _=Math.floor(f.length/2);return f.length%2?f[_]:(f[_-1]+f[_])/2},I.clamp=function(f,_,y){return Math.min(Math.max(f,_),y)},I}(),r=function(I,f){this.width=I,this.height=f},d=function(){function I(){}return I.fitRect=function(f,_,y,S){var L,P=0,pt=0;return _/f<S/y?(P=f*(L=y/f),pt=_*L):(P=f*(L=S/_),pt=_*L),new r(Math.floor(P),Math.floor(pt))},I.hitRect=function(f,_,y,S,L,P){return L>f&&L<f+y&&P>_&&P<_+S},I}(),E=function(){function I(){}return I.numericalInput=function(f){return f.keyCode==46||f.keyCode==8||f.keyCode==9||f.keyCode==27||f.keyCode==65&&f.ctrlKey===!0||f.keyCode>=35&&f.keyCode<=39||!(f.shiftKey||(f.keyCode<48||f.keyCode>57)&&(f.keyCode<96||f.keyCode>105))||(f.preventDefault(),!1)},I}(),x=function(){function I(){}return I.toPlainObject=function(f){f=Object(f);var _={};for(var y in f)_[y]=f[y];return _},I}(),T=function(){function I(){}return I.clear=function(f){switch(f===void 0&&(f=u.MEMORY),f){case u.MEMORY:this._memoryStorage={};break;case u.SESSION:sessionStorage.clear();break;case u.LOCAL:localStorage.clear()}},I.clearExpired=function(f){f===void 0&&(f=u.MEMORY);for(var _=this.getItems(f),y=0;y<_.length;y++){var S=_[y];this._isExpired(S)&&this.remove(S.key)}},I.get=function(f,_){_===void 0&&(_=u.MEMORY);var y=null;switch(_){case u.MEMORY:y=this._memoryStorage[f];break;case u.SESSION:y=sessionStorage.getItem(f);break;case u.LOCAL:y=localStorage.getItem(f)}if(!y)return null;var S=null;try{S=JSON.parse(y)}catch{return null}return S?this._isExpired(S)?null:(S.key=f,S):null},I._isExpired=function(f){return!(new Date().getTime()<f.expiresAt)},I.getItems=function(f){f===void 0&&(f=u.MEMORY);var _=[];switch(f){case u.MEMORY:for(var y=Object.keys(this._memoryStorage),S=0;S<y.length;S++)(P=this.get(y[S],u.MEMORY))&&_.push(P);break;case u.SESSION:for(S=0;S<sessionStorage.length;S++)(L=sessionStorage.key(S))&&(P=this.get(L,u.SESSION))&&_.push(P);break;case u.LOCAL:for(S=0;S<localStorage.length;S++){var L,P;(L=localStorage.key(S))&&(P=this.get(L,u.LOCAL))&&_.push(P)}}return _},I.remove=function(f,_){switch(_===void 0&&(_=u.MEMORY),_){case u.MEMORY:delete this._memoryStorage[f];break;case u.SESSION:sessionStorage.removeItem(f);break;case u.LOCAL:localStorage.removeItem(f)}},I.set=function(f,_,y,S){S===void 0&&(S=u.MEMORY);var L=1e3*y,P=new A;switch(P.value=_,P.expiresAt=new Date().getTime()+L,S){case u.MEMORY:this._memoryStorage[f]=JSON.stringify(P);break;case u.SESSION:sessionStorage.setItem(f,JSON.stringify(P));break;case u.LOCAL:localStorage.setItem(f,JSON.stringify(P))}return P},I._memoryStorage={},I}(),A=function(){};(function(I){I.MEMORY="memory",I.SESSION="session",I.LOCAL="local"})(u||(u={}));var O=function(){function I(){}return I.ellipsis=function(f,_){if(f.length<=_)return f;var y=f.substr(0,_),S=y.lastIndexOf(" ");return S!=-1&&(y=y.substr(0,Math.min(y.length,S))),y+"&hellip;"},I.htmlDecode=function(f){var _=document.createElement("div");return _.innerHTML=f,_.firstChild.nodeValue},I.format=function(f){for(var _=[],y=1;y<arguments.length;y++)_[y-1]=arguments[y];for(var S=0;S<_.length;S++){var L=new RegExp("\\{"+S+"\\}","gm");f=f.replace(L,_[S])}return f},I.isAlphanumeric=function(f){return/^[a-zA-Z0-9]*$/.test(f)},I.toCssClass=function(f){return f.replace(/[^a-z0-9]/g,function(_){var y=_.charCodeAt(0);return y==32?"-":y>=65&&y<=90?"_"+_.toLowerCase():"__"+("000"+y.toString(16)).slice(-4)})},I.toFileName=function(f){return f.replace(/[^a-z0-9]/gi,"_").toLowerCase()},I.utf8_to_b64=function(f){return window.btoa(unescape(encodeURIComponent(f)))},I}(),C=function(){function I(){}return I.getHashParameter=function(f,_){return _||(_=window.document),_&&_.location?this.getHashParameterFromString(f,_.location.hash):null},I.getHashParameterFromString=function(f,_){var y=new RegExp("#.*[?&]"+f+"=([^&]+)(&|$)").exec(_);return y?decodeURIComponent(y[1].replace(/\+/g," ")):null},I.setHashParameter=function(f,_,y){if(y||(y=window.document),y&&y.location){var S="#?"+this.updateURIKeyValuePair(y.location.hash.replace("#?",""),f,_),L=y.URL;L.indexOf("#")!=-1&&(L=L.substr(0,L.indexOf("#"))),y.location.replace(L+S)}},I.getQuerystringParameter=function(f,_){return _||(_=window),this.getQuerystringParameterFromString(f,_.location.search)},I.getQuerystringParameterFromString=function(f,_){f=f.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var y=new RegExp("[\\?&]"+f+"=([^&#]*)").exec(_);return y?decodeURIComponent(y[1].replace(/\+/g," ")):null},I.setQuerystringParameter=function(f,_,y){if(y||(y=window.document),y&&y.location){var S=this.updateURIKeyValuePair(y.location.hash.replace("#?",""),f,_);window.location.search=S}},I.updateURIKeyValuePair=function(f,_,y){_=encodeURIComponent(_),y=encodeURIComponent(y);var S=f.split("&");S[0]==""&&S.shift();for(var L,P=S.length;P--;)if((L=S[P].split("="))[0]==_){L[1]=y,S[P]=L.join("=");break}return P<0&&(S[S.length]=[_,y].join("=")),S.join("&")},I.getUrlParts=function(f){var _=document.createElement("a");return _.href=f,_},I.convertToRelativeUrl=function(f){var _=this.getUrlParts(f),y=_.pathname+_.searchWithin;return y.startsWith("/")||(y="/"+y),y},I}()}])})});var st=class{constructor(i,a){this.informationType=i;this.param=a}};var q;(function(a){a[a.AUTH_CORS_ERROR=0]="AUTH_CORS_ERROR",a[a.DEGRADED_RESOURCE=1]="DEGRADED_RESOURCE"})(q||(q={}));var ut=class{};ut.FORBIDDEN="forbiddenResourceMessage";var Z=et(Lt());var j=et(Rt());var Jt=window.$,N=class{static loadExternalResources(i,a){return new Promise(u=>{Z.Utils.loadExternalResourcesAuth09(i,a,N.clickThrough,N.restricted,N.login,N.getAccessToken,N.storeAccessToken,N.getStoredAccessToken,N.handleExternalResourceResponse).then(c=>{u(c)}).catch(c=>{switch(c.name){case Z.StatusCode.AUTHORIZATION_FAILED.toString():N.publish(b.LOGIN_FAILED);break;case Z.StatusCode.FORBIDDEN.toString():N.publish(b.FORBIDDEN);break;case Z.StatusCode.RESTRICTED.toString():break;default:N.publish(b.SHOW_MESSAGE,[c.message||c])}})})}static clickThrough(i){return new Promise(a=>{N.publish(b.SHOW_CLICKTHROUGH_DIALOGUE,[{resource:i,acceptCallback:()=>{if(i.clickThroughService){let u=window.open(i.clickThroughService.id),c=window.setInterval(()=>{u&&u.closed&&(window.clearInterval(c),N.publish(b.CLICKTHROUGH),a())},500)}}}])})}static restricted(i){return new Promise((a,u)=>{N.publish(b.SHOW_RESTRICTED_DIALOGUE,[{resource:i,acceptCallback:()=>{N.publish(w.LOAD_FAILED),u(i)}}])})}static login(i){return new Promise(a=>{let u={};i.status===j.FORBIDDEN&&(u.warningMessage=ut.FORBIDDEN,u.showCancelButton=!0),console.log("login"),N.publish(b.SHOW_LOGIN_DIALOGUE,[{resource:i,loginCallback:()=>{if(i.loginService){let c=window.open(i.loginService.id+"?t="+new Date().getTime()),m=window.setInterval(function(){c&&c.closed&&(window.clearInterval(m),N.publish(b.LOGIN),a())},500)}},logoutCallback:()=>{if(i.logoutService){let c=window.open(i.logoutService.id+"?t="+new Date().getTime()),m=window.setInterval(function(){c&&c.closed&&(window.clearInterval(m),N.publish(b.LOGOUT),a())},500)}},options:u}])})}static getAccessToken(i,a){return new Promise((u,c)=>{if(i.tokenService){let m=i.tokenService.id,o=m+"|"+new Date().getTime(),v=l=>{window.removeEventListener("message",v);let p=l.data;p.error?c(a?p.errorDescription:void 0):u(p)};window.addEventListener("message",v,!1);let g=m+"?messageId="+o;Jt("#commsFrame").prop("src",g)}else c("Token service not found")})}static storeAccessToken(i,a,u){return new Promise((c,m)=>{i.tokenService?(D.set(i.tokenService.id,a,a.expiresIn,u),c()):m("Token service not found")})}static getStoredAccessToken(i,a){return new Promise((u,c)=>{let m=[],o=null;if(i.tokenService&&(o=D.get(i.tokenService.id,a)),o)m.push(o);else{let g=G.getUrlParts(i.dataUri).hostname,l=D.getItems(a);for(let p=0;p<l.length;p++)o=l[p],o.key.includes(g)&&m.push(o)}m=m.sort((g,l)=>g.expiresAt-l.expiresAt);let v;m.length&&(v=m[m.length-1].value,u(v))})}static handleExternalResourceResponse(i){return new Promise((a,u)=>{if(i.isResponseHandled=!0,i.status===j.OK)a(i);else if(i.status===j.MOVED_TEMPORARILY)a(i),N.publish(b.RESOURCE_DEGRADED,[i]);else if(i.error.status===j.UNAUTHORIZED||i.error.status===j.INTERNAL_SERVER_ERROR)u(i.error.statusText);else if(i.error.status===j.FORBIDDEN){let c=new Error;c.message="Forbidden",c.name=Z.StatusCode.FORBIDDEN.toString(),u(c)}else u(i.error.statusText)})}static handleDegraded(i){let a=new st(q.DEGRADED_RESOURCE,i);N.publish(b.SHOW_INFORMATION,[a])}};var it=et(Lt());var Pt=et(Rt()),zt=window.$,M=class{static loadExternalResources(i,a,u){return new Promise(c=>{M.storageStrategy=a,i=i.map(m=>(m.authAPIVersion=1,m.options=u,m)),it.Utils.loadExternalResourcesAuth1(i,M.openContentProviderInteraction,M.openTokenService,M.getStoredAccessToken,M.userInteractedWithContentProvider,M.getContentProviderInteraction,M.handleMovedTemporarily,M.showOutOfOptionsMessages).then(m=>{c(m)}).catch(m=>{switch(m.name){case it.StatusCode.AUTHORIZATION_FAILED.toString():M.publish(b.LOGIN_FAILED);break;case it.StatusCode.FORBIDDEN.toString():M.publish(b.FORBIDDEN);break;case it.StatusCode.RESTRICTED.toString():break;default:M.publish(b.SHOW_MESSAGE,[m.message||m])}})})}static getCookieServiceUrl(i){return i.id+"?origin="+M.getOrigin()}static openContentProviderInteraction(i){let a=M.getCookieServiceUrl(i);return window.open(a)}static getOrigin(i){let a=window.location;return i&&(a=document.createElement("a"),a.href=i),a.protocol+"//"+a.hostname+(a.port?":"+a.port:"")}static userInteractedWithContentProvider(i){return new Promise(a=>{let u=window.setInterval(()=>{i.closed&&(window.clearInterval(u),a(!0))},500)})}static handleMovedTemporarily(i){return new Promise(a=>{M.showDegradedMessage(i),i.isResponseHandled=!0,a()})}static showDegradedMessage(i){if(i.kioskService)M.publish(b.OPEN_EXTERNAL_RESOURCE,[[i]]);else{let a=new st(q.DEGRADED_RESOURCE,i);M.publish(b.SHOW_INFORMATION,[a])}}static storeAccessToken(i,a){return new Promise((u,c)=>{i.tokenService?(D.set(i.tokenService.id,a,a.expiresIn||3600,M.storageStrategy),u()):c("Token service not found")})}static getStoredAccessToken(i){return new Promise((a,u)=>{let c=[],m=null;if(i.tokenService&&(m=D.get(i.tokenService.id,M.storageStrategy)),m)c.push(m);else{let v=G.getUrlParts(i.dataUri).hostname,g=D.getItems(M.storageStrategy);for(let l=0;l<g.length;l++)m=g[l],m.key.includes(v)&&c.push(m)}c=c.sort((v,g)=>v.expiresAt-g.expiresAt);let o=null;c.length&&(o=c[c.length-1].value),a(o)})}static getContentProviderInteraction(i,a){return new Promise(u=>{i.isResponseHandled&&!i.authHoldingPage?(M.showDegradedMessage(i),u(null)):i.authHoldingPage?(i.authHoldingPage.location.href=M.getCookieServiceUrl(a),u(i.authHoldingPage)):M.publish(b.SHOW_AUTH_DIALOGUE,[{service:a,closeCallback:()=>{u(null)},confirmCallback:()=>{let c=M.openContentProviderInteraction(a);u(c)},cancelCallback:()=>{u(null)}}])})}static openTokenService(i,a){return new Promise((u,c)=>{let m=M.getOrigin(a.id),o=new Date().getTime();M.messages[o]={resolve:u,reject:c,serviceOrigin:m,resource:i},window.addEventListener("message",M.receiveToken,!1);let v=a.id+"?messageId="+o+"&origin="+M.getOrigin();zt("#commsFrame").prop("src",v);let g=5e3;setTimeout(()=>{M.messages[o]&&(M.messages[o].reject("Message unhandled after "+g+"ms, rejecting"),delete M.messages[o])},g)})}static receiveToken(i){if(i.data.hasOwnProperty("messageId")){let a=M.messages[i.data.messageId];a&&i.origin==a.serviceOrigin&&M.storeAccessToken(a.resource,i.data).then(()=>{a.resolve(i.data),delete M.messages[i.data.messageId]})}}static showOutOfOptionsMessages(i,a){if(i.status==Pt.MOVED_TEMPORARILY)return;let u="";a.getFailureHeader()&&(u+="<p>"+a.getFailureHeader()+"</p>"),a.getFailureDescription()&&(u+=a.getFailureDescription()),M.publish(b.SHOW_MESSAGE,[V(u)])}},ot=M;ot.messages={};var gt=class{constructor(i,a,u){this.isResized=!1;this.$element=i,this.fitToParentWidth=a||!1,this.fitToParentHeight=u||!1,this.create()}create(){this.extensionHost?.subscribe(w.RESIZE,()=>{this.resize()})}whenResized(i){Tt.waitFor(()=>this.isResized,i)}onAccessibleClick(i,a,u=!0){u&&i.on("click",c=>{a(c)}),i.on("keyup",c=>{c.keyCode===32&&a(c)})}resize(){let i=this.$element.parent();this.fitToParentWidth&&this.$element.width(i.width()),this.fitToParentHeight&&this.$element.height(i.height()),this.isResized=!0}};var Wt=window.$,U=class extends gt{constructor(i,a,u){super(i,a,u)}create(){this.extensionHost=this.$element.closest(".uv-iiif-extension-host").data("component"),super.create(),this.extension=this.extensionHost.extension,this.config={},this.config.content={},this.config.options={};var i=this;i.modules&&i.modules.length&&(i.modules=i.modules.reverse(),i.modules.forEach(a=>{i.config=Wt.extend(!0,i.config,i.extension.data.config.modules[a])})),this.content=this.config.content,this.options=this.config.options}init(){}setConfig(i){this.modules||(this.modules=[]),this.modules.push(i)}resize(){super.resize()}};var K=window.$,k=class extends U{constructor(i){super(i,!1,!1);this.allowClose=!0;this.isActive=!1;this.isUnopened=!0}create(){this.setConfig("dialogue"),super.create(),this.extensionHost.subscribe(b.CLOSE_ACTIVE_DIALOGUE,()=>{this.isActive&&this.allowClose&&this.close()}),this.extensionHost.subscribe(b.ESCAPE,()=>{this.isActive&&this.allowClose&&this.close()}),this.$top=K('<div class="top"></div>'),this.$element.append(this.$top),this.$closeButton=K('<button type="button" class="btn btn-default close" tabindex="0">'+this.content.close+"</button>"),this.$middle=K('<div class="middle"></div>'),this.$element.append(this.$middle),this.$content=K('<div class="content"></div>'),this.$middle.append(this.$content),this.$buttons=K('<div class="buttons"></div>'),this.$middle.append(this.$buttons),this.$bottom=K('<div class="bottom"></div>'),this.$element.append(this.$bottom),this.config.topCloseButtonEnabled?this.$top.append(this.$closeButton):this.$buttons.append(this.$closeButton),this.$closeButton.on("click",i=>{i.preventDefault(),this.close()}),this.returnFunc=this.close}enableClose(){this.allowClose=!0,this.$closeButton.show()}disableClose(){this.allowClose=!1,this.$closeButton.hide()}setDockedPosition(){let i=Math.floor(this.extension.height()-this.$element.outerHeight(!0)),a=0,u=0,c=0;if(this.$triggerButton){let m=4,o=2,v=this.$triggerButton.offset().top,g=this.extension.$element.offset().top,l=this.$element.outerHeight(!0);i=v-g-l+m;let h=this.$triggerButton.offset().left,e=this.extension.$element.offset().left,t=h-e;c=Ot.normalise(t,0,this.extension.width()),a=Math.floor(this.extension.width()*c-this.$element.width()*c)+o,u=Math.floor(this.$element.width()*c)}this.$bottom.css("backgroundPosition",u+"px 0px"),this.$element.css({top:i,left:a})}open(i){this.$element.attr("aria-hidden","false"),this.$element.show(),i?(this.$triggerButton=K(i),this.$bottom.show()):this.$bottom.hide(),this.isActive=!0,setTimeout(()=>{let a=this.$element.find(".default");if(a.length)a.focus();else{let u=this.$element.find("input:visible").first();u.length?u.focus():this.$closeButton.focus()}},1),this.extensionHost.publish(b.SHOW_OVERLAY),this.isUnopened&&(this.isUnopened=!1,this.afterFirstOpen()),this.resize()}afterFirstOpen(){}close(){!this.isActive||(this.$element.attr("aria-hidden","true"),this.$element.hide(),this.isActive=!1,this.extensionHost.publish(this.closeCommand),this.extensionHost.publish(b.HIDE_OVERLAY))}resize(){super.resize(),this.$element.css({top:Math.floor(this.extension.height()/2-this.$element.height()/2),left:Math.floor(this.extension.width()/2-this.$element.width()/2)})}};var Nt=window.$,mt=class extends k{constructor(i){super(i)}create(){this.setConfig("authDialogue"),super.create(),this.openCommand=b.SHOW_AUTH_DIALOGUE,this.closeCommand=b.HIDE_AUTH_DIALOGUE,this.extensionHost.subscribe(this.openCommand,i=>{let a=Array.isArray(i)?i[0]:i;this.closeCallback=a.closeCallback,this.confirmCallback=a.confirmCallback,this.cancelCallback=a.cancelCallback,this.service=a.service,this.open()}),this.extensionHost.subscribe(this.closeCommand,()=>{this.close()}),this.$title=Nt('<div role="heading" class="heading"></div>'),this.$content.append(this.$title),this.$content.append('            <div>                <p class="message scroll"></p>            </div>'),this.$buttons.prepend(this._buttonsToAdd()),this.$message=this.$content.find(".message"),this.$confirmButton=this.$buttons.find(".confirm"),this.$confirmButton.text(this.content.confirm),this.$cancelButton=this.$buttons.find(".close"),this.$cancelButton.text(this.content.cancel),this.$element.hide(),this.$confirmButton.on("click",i=>{i.preventDefault(),this.confirmCallback&&this.confirmCallback(),this.close()}),this.$cancelButton.on("click",i=>{i.preventDefault(),this.cancelCallback&&this.cancelCallback(),this.close()})}open(){if(!this.service){console.error("NO SERVICE");return}super.open();let i=this.service.getHeader(),a=this.service.getDescription(),u=this.service.getConfirmLabel();i&&this.$title.text(V(i)),a&&(this.$message.html(V(a)),this.$message.targetBlank(),this.$message.find("a").on("click",function(){let c=Nt(this).attr("href");this.extensionHost.publish(b.EXTERNAL_LINK_CLICKED,c)})),u&&this.$confirmButton.text(V(u)),this.resize()}resize(){super.resize()}_buttonsToAdd(){var i='<a class="confirm btn btn-primary" href="#" target="_parent"></a>';return this.config.topCloseButtonEnabled&&(i+='<button class="close btn btn-default"></button>'),i}};var Ht=window.$,vt=class extends k{constructor(i){super(i)}create(){this.setConfig("clickThroughDialogue"),super.create(),this.openCommand=b.SHOW_CLICKTHROUGH_DIALOGUE,this.closeCommand=b.HIDE_CLICKTHROUGH_DIALOGUE,this.extensionHost.subscribe(this.openCommand,i=>{this.acceptCallback=i.acceptCallback,this.resource=i.resource,this.open()}),this.extensionHost.subscribe(this.closeCommand,()=>{this.close()}),this.$title=Ht('<div role="heading" class="heading"></div>'),this.$content.append(this.$title),this.$content.append('            <div>                <p class="message scroll"></p>                <div class="buttons">                    <a class="acceptTerms btn btn-primary" href="#" target="_parent"></a>                </div>            </div>'),this.$message=this.$content.find(".message"),this.$acceptTermsButton=this.$content.find(".acceptTerms"),this.$acceptTermsButton.text("Accept Terms and Open"),this.$element.hide(),this.$acceptTermsButton.on("click",i=>{i.preventDefault(),this.close(),this.extensionHost.publish(b.ACCEPT_TERMS),this.acceptCallback&&this.acceptCallback()})}open(){super.open(),this.resource.clickThroughService&&(this.$title.text(this.resource.clickThroughService.getProperty("label")),this.$message.html(this.resource.clickThroughService.getProperty("description")),this.$message.targetBlank()),this.$message.find("a").on("click",function(){var i=Ht(this).attr("href");this.extensionHost.publish(b.EXTERNAL_LINK_CLICKED,i)}),this.resize()}resize(){super.resize()}};var Bt=window.$,Et=class extends k{constructor(i){super(i)}create(){this.setConfig("loginDialogue"),super.create(),this.openCommand=b.SHOW_LOGIN_DIALOGUE,this.closeCommand=b.HIDE_LOGIN_DIALOGUE,this.extensionHost.subscribe(this.openCommand,i=>{this.loginCallback=i.loginCallback,this.logoutCallback=i.logoutCallback,this.options=i.options,this.resource=i.resource,this.open()}),this.extensionHost.subscribe(this.closeCommand,()=>{this.close()}),this.$title=Bt('<div role="heading" class="heading"></div>'),this.$content.append(this.$title),this.$content.append('            <div>                <p class="message scroll"></p>                <div class="buttons">                    <a class="logout btn btn-primary" href="#" target="_parent"></a>                    <a class="login btn btn-primary" href="#" target="_parent"></a>                    <a class="cancel btn btn-primary" href="#"></a>                </div>            </div>'),this.$message=this.$content.find(".message"),this.$loginButton=this.$content.find(".login"),this.$loginButton.text(this.content.login),this.$logoutButton=this.$content.find(".logout"),this.$logoutButton.text(this.content.logout),this.$cancelButton=this.$content.find(".cancel"),this.$cancelButton.text(this.content.cancel),this.$element.hide(),this.$loginButton.on("click",i=>{i.preventDefault(),this.close(),this.loginCallback&&this.loginCallback()}),this.$logoutButton.on("click",i=>{i.preventDefault(),this.close(),this.logoutCallback&&this.logoutCallback()}),this.$cancelButton.on("click",i=>{i.preventDefault(),this.close()}),this.updateLogoutButton()}open(){super.open();let i="";this.resource.loginService&&(this.$title.text(this.resource.loginService.getProperty("label")),i=this.resource.loginService.getProperty("description")),this.options.warningMessage&&(i='<span class="warning">'+this.extension.data.config.content[this.options.warningMessage]+'</span><span class="description">'+i+"</span>"),this.updateLogoutButton(),this.$message.html(i),this.$message.targetBlank(),this.$message.find("a").on("click",function(){var a=Bt(this).attr("href");this.extensionHost.publish(b.EXTERNAL_LINK_CLICKED,a)}),this.options.showCancelButton?this.$cancelButton.show():this.$cancelButton.hide(),this.resize()}updateLogoutButton(){this.extension.isLoggedIn?this.$logoutButton.show():this.$logoutButton.hide()}resize(){super.resize()}};var kt=window.$,bt=class extends k{constructor(i){super(i)}create(){this.setConfig("restrictedDialogue"),super.create(),this.openCommand=b.SHOW_RESTRICTED_DIALOGUE,this.closeCommand=b.HIDE_RESTRICTED_DIALOGUE,this.extensionHost.subscribe(this.openCommand,i=>{this.acceptCallback=i.acceptCallback,this.options=i.options,this.resource=i.resource,this.open()}),this.extensionHost.subscribe(this.closeCommand,()=>{this.close()}),this.$title=kt('<div role="heading" class="heading"></div>'),this.$content.append(this.$title),this.$content.append('            <div>                <p class="message scroll"></p>                <div class="buttons">                    <a class="cancel btn btn-primary" href="#" target="_parent"></a>                </div>            </div>'),this.$message=this.$content.find(".message"),this.$message.targetBlank(),this.$cancelButton=this.$content.find(".cancel"),this.$cancelButton.text(this.content.cancel),this.$element.hide(),this.$cancelButton.on("click",i=>{i.preventDefault(),this.close()})}open(){super.open(),this.isAccepted=!1;let i="";this.resource.restrictedService&&(this.$title.text(this.resource.restrictedService.getProperty("label")),i=this.resource.restrictedService.getProperty("description")),this.$message.html(i),this.$message.targetBlank(),this.$message.find("a").on("click",function(){var a=kt(this).attr("href");this.extensionHost.publish(b.EXTERNAL_LINK_CLICKED,a)}),this.resize()}close(){super.close(),!this.isAccepted&&this.acceptCallback&&(this.isAccepted=!0,this.acceptCallback())}resize(){super.resize()}};var Ft=window.$,_t=class extends k{constructor(i){super(i)}create(){this.setConfig("genericDialogue"),super.create(),this.openCommand=b.SHOW_GENERIC_DIALOGUE,this.closeCommand=b.HIDE_GENERIC_DIALOGUE,this.extensionHost.subscribe(this.openCommand,i=>{this.acceptCallback=i.acceptCallback,this.showMessage(i)}),this.extensionHost.subscribe(this.closeCommand,()=>{this.close()}),this.$message=Ft("<p></p>"),this.$content.append(this.$message),this.$acceptButton=Ft(`
          <button class="btn btn-primary accept default">
            ${this.content.ok}
          </button>
        `),this.$buttons.append(this.$acceptButton),this.$buttons.find(".close").hide(),this.$acceptButton.onPressed(()=>{this.accept()}),this.returnFunc=()=>{this.isActive&&this.accept()},this.$element.hide()}accept(){this.extensionHost.publish(b.CLOSE_ACTIVE_DIALOGUE),this.acceptCallback&&this.acceptCallback()}showMessage(i){this.$message.html(i.message),i.buttonText?this.$acceptButton.text(i.buttonText):this.$acceptButton.text(this.content.ok),i.allowClose===!1&&this.disableClose(),this.open()}resize(){super.resize()}};var J=window.$,It=class extends U{constructor(i){super(i,!0,!0)}create(){super.create(),this.extensionHost.subscribe(b.SHOW_OVERLAY,()=>{this.$overlays.show()}),this.extensionHost.subscribe(b.HIDE_OVERLAY,()=>{this.$overlays.hide()}),this.$element.append('<a class="sr-only" href="#download-btn">'+this.extension.data.config.content.skipToDownload+"</a>"),this.$headerPanel=J('<div class="headerPanel"></div>'),this.$element.append(this.$headerPanel),this.$mainPanel=J('<div class="mainPanel"></div>'),this.$element.append(this.$mainPanel),this.$centerPanel=J('<div class="centerPanel"></div>'),this.$centerPanel.append('<h2 class="sr-only">'+this.extension.data.config.content.mediaViewer+"</h2>"),this.$mainPanel.append(this.$centerPanel),this.$leftPanel=J('<div class="leftPanel"></div>'),this.$mainPanel.append(this.$leftPanel),this.$rightPanel=J('<div class="rightPanel"></div>'),this.$mainPanel.append(this.$rightPanel),this.$footerPanel=J('<div class="footerPanel"></div>'),this.$element.append(this.$footerPanel),this.$mobileFooterPanel=J('<div class="mobileFooterPanel"></div>'),this.$element.append(this.$mobileFooterPanel),this.$overlays=J('<div class="overlays"></div>'),this.$element.append(this.$overlays),this.$overlays.hide(),this.$genericDialogue=J('<div class="overlay genericDialogue" aria-hidden="true"></div>'),this.$overlays.append(this.$genericDialogue),this.$overlays.on("click",i=>{J(i.target).hasClass("overlays")&&(i.preventDefault(),this.extensionHost.publish(b.CLOSE_ACTIVE_DIALOGUE))}),new _t(this.$genericDialogue)}resize(){super.resize(),setTimeout(()=>{this.$overlays.width(this.extension.width()),this.$overlays.height(this.extension.height())},1);let i=this.$element.height()-parseInt(this.$mainPanel.css("paddingTop"))-(F(this.$headerPanel)?this.$headerPanel.height():0)-(F(this.$footerPanel)?this.$footerPanel.height():0)-(F(this.$mobileFooterPanel)?this.$mobileFooterPanel.height():0);this.$mainPanel.height(i)}};var Dt=et(Qt());var B;(function(s){s[s.Backspace=8]="Backspace",s[s.Tab=9]="Tab",s[s.Enter=13]="Enter",s[s.Shift=16]="Shift",s[s.Ctrl=17]="Ctrl",s[s.Alt=18]="Alt",s[s.PauseBreak=19]="PauseBreak",s[s.CapsLock=20]="CapsLock",s[s.Escape=27]="Escape",s[s.Spacebar=32]="Spacebar",s[s.PageUp=33]="PageUp",s[s.PageDown=34]="PageDown",s[s.End=35]="End",s[s.Home=36]="Home",s[s.LeftArrow=37]="LeftArrow",s[s.UpArrow=38]="UpArrow",s[s.RightArrow=39]="RightArrow",s[s.DownArrow=40]="DownArrow",s[s.PrintScrn=44]="PrintScrn",s[s.Insert=45]="Insert",s[s.Delete=46]="Delete",s[s.Zero=48]="Zero",s[s.One=49]="One",s[s.Two=50]="Two",s[s.Three=51]="Three",s[s.Four=52]="Four",s[s.Five=53]="Five",s[s.Six=54]="Six",s[s.Seven=55]="Seven",s[s.Eight=56]="Eight",s[s.Nine=57]="Nine",s[s.a=65]="a",s[s.b=66]="b",s[s.c=67]="c",s[s.d=68]="d",s[s.e=69]="e",s[s.f=70]="f",s[s.g=71]="g",s[s.h=72]="h",s[s.i=73]="i",s[s.j=74]="j",s[s.k=75]="k",s[s.l=76]="l",s[s.m=77]="m",s[s.n=78]="n",s[s.o=79]="o",s[s.p=80]="p",s[s.q=81]="q",s[s.r=82]="r",s[s.s=83]="s",s[s.t=84]="t",s[s.u=85]="u",s[s.v=86]="v",s[s.w=87]="w",s[s.x=88]="x",s[s.y=89]="y",s[s.z=90]="z",s[s.LeftWindowKey=91]="LeftWindowKey",s[s.RightWindowKey=92]="RightWindowKey",s[s.SelectKey=93]="SelectKey",s[s.Numpad0=96]="Numpad0",s[s.Numpad1=97]="Numpad1",s[s.Numpad2=98]="Numpad2",s[s.Numpad3=99]="Numpad3",s[s.Numpad4=100]="Numpad4",s[s.Numpad5=101]="Numpad5",s[s.Numpad6=102]="Numpad6",s[s.Numpad7=103]="Numpad7",s[s.Numpad8=104]="Numpad8",s[s.Numpad9=105]="Numpad9",s[s.Multiply=106]="Multiply",s[s.NumpadPlus=107]="NumpadPlus",s[s.NumpadMinus=109]="NumpadMinus",s[s.DecimalPoint=110]="DecimalPoint",s[s.Divide=111]="Divide",s[s.F1=112]="F1",s[s.F2=113]="F2",s[s.F3=114]="F3",s[s.F4=115]="F4",s[s.F5=116]="F5",s[s.F6=117]="F6",s[s.F7=118]="F7",s[s.F8=119]="F8",s[s.F9=120]="F9",s[s.F10=121]="F10",s[s.F11=122]="F11",s[s.F12=123]="F12",s[s.NumLock=144]="NumLock",s[s.ScrollLock=145]="ScrollLock",s[s.Semicolon=186]="Semicolon",s[s.Equals=187]="Equals",s[s.Comma=188]="Comma",s[s.LessThan=188]="LessThan",s[s.Dash=189]="Dash",s[s.Period=190]="Period",s[s.GreaterThan=190]="GreaterThan",s[s.ForwardSlash=191]="ForwardSlash",s[s.QuestionMark=191]="QuestionMark",s[s.GraveAccent=192]="GraveAccent",s[s.Tilde=192]="Tilde",s[s.OpenCurlyBracket=219]="OpenCurlyBracket",s[s.OpenSquareBracket=219]="OpenSquareBracket",s[s.BackSlash=220]="BackSlash",s[s.VerticalPipe=220]="VerticalPipe",s[s.CloseCurlyBracket=221]="CloseCurlyBracket",s[s.CloseSquareBracket=221]="CloseSquareBracket",s[s.Quote=222]="Quote",s[s.CommandFF=224]="CommandFF"})(B||(B={}));var Ut;(function(s){s[s.Backspace=8]="Backspace",s[s.Enter=13]="Enter",s[s.Spacebar=32]="Spacebar",s[s.Hash=35]="Hash",s[s.GraveAccent=39]="GraveAccent",s[s.DoubleQuote=34]="DoubleQuote",s[s.Asterisk=42]="Asterisk",s[s.Plus=43]="Plus",s[s.Comma=44]="Comma",s[s.Minus=45]="Minus",s[s.Period=46]="Period",s[s.ForwardSlash=47]="ForwardSlash",s[s.Zero=48]="Zero",s[s.One=49]="One",s[s.Two=50]="Two",s[s.Three=51]="Three",s[s.Four=52]="Four",s[s.Five=53]="Five",s[s.Six=54]="Six",s[s.Seven=55]="Seven",s[s.Eight=56]="Eight",s[s.Nine=57]="Nine",s[s.Colon=58]="Colon",s[s.Semicolon=59]="Semicolon",s[s.LessThan=60]="LessThan",s[s.Equals=61]="Equals",s[s.GreaterThan=62]="GreaterThan",s[s.QuestionMark=63]="QuestionMark",s[s.At=64]="At",s[s.OpenSquareBracket=91]="OpenSquareBracket",s[s.BackSlash=92]="BackSlash",s[s.CloseSquareBracket=93]="CloseSquareBracket",s[s.a=97]="a",s[s.b=98]="b",s[s.c=99]="c",s[s.d=100]="d",s[s.e=101]="e",s[s.f=102]="f",s[s.g=103]="g",s[s.h=104]="h",s[s.i=105]="i",s[s.j=106]="j",s[s.k=107]="k",s[s.l=108]="l",s[s.m=109]="m",s[s.n=110]="n",s[s.o=111]="o",s[s.p=112]="p",s[s.q=113]="q",s[s.r=114]="r",s[s.s=115]="s",s[s.t=116]="t",s[s.u=117]="u",s[s.v=118]="v",s[s.w=119]="w",s[s.x=120]="x",s[s.y=121]="y",s[s.z=122]="z",s[s.OpenCurlyBracket=123]="OpenCurlyBracket",s[s.VerticalPipe=124]="VerticalPipe",s[s.CloseCurlyBracket=125]="CloseCurlyBracket",s[s.Tilde=126]="Tilde"})(Ut||(Ut={}));var z=window.$,qt=class{constructor(){this.annotations=[];this.isCreated=!1;this.isLoggedIn=!1;this.metrics=[];this.shifted=!1;this.tabbing=!1;this.locales={}}create(){let i=this;if(this.browserDetect=new Gt,this.browserDetect.init(),N.publish=this.extensionHost.publish.bind(this.extensionHost),ot.publish=this.extensionHost.publish.bind(this.extensionHost),this.$element=z(this.extensionHost.options.target),this.$element.data("component",this.extensionHost),this._parseMetrics(),this._initLocales(),this.$element.empty(),this.$element.removeClass(),this.$element.addClass("uv-iiif-extension-host"),this.$element.addClass("loading"),this.data.locales&&this.$element.addClass(this.data.locales[0].name.toLowerCase()),this.isRightPanelEnabled()&&this.$element.addClass("right-panel-enabled"),this.isLeftPanelEnabled()&&this.$element.addClass("left-panel-enabled"),this.isFooterPanelEnabled()&&this.$element.addClass("footer-panel-enabled"),this.$element.addClass(this.type.name),this.$element.addClass("browser-"+this.browserDetect.browser),this.$element.addClass("browser-version-"+this.browserDetect.version),this.$element.prop("tabindex",-1),this.data.embedded&&this.$element.addClass("embedded"),this.isMobile()&&this.$element.addClass("mobile"),Y.supportsFullscreen()&&this.$element.addClass("fullscreen-supported"),this.isFullScreen()&&this.$element.addClass("fullscreen"),this.$element.on("mousemove",a=>{this.mouseX=a.pageX,this.mouseY=a.pageY}),!this.data.isReload){let a=Y.getHiddenProp();if(a){let u=a.replace(/[H|h]idden/,"")+"visibilitychange";document.addEventListener(u,()=>{Y.isHidden()||this.resize()})}R.getBool(this.data.config.options.dropEnabled,!0)&&this.$element.on("drop",u=>{u.preventDefault();let c=u.originalEvent.dataTransfer.getData("URL"),m=G.getUrlParts(c),o=G.getQuerystringParameterFromString("manifest",m.search);if(o||(o=G.getQuerystringParameterFromString("collection",m.search)),o){this.fire(w.DROP,o);let v={};v.iiifManifestId=o,this.reload(v)}}),this.$element.on("dragover",u=>{u.preventDefault()}),this.$element.on("keyup keydown",u=>{this.shifted=u.shiftKey,this.tabbing=u.keyCode===B.Tab}),this.$element.on("keydown",u=>{let c=null,m=!0;!u.ctrlKey&&!u.altKey&&!u.shiftKey&&(u.keyCode===B.Enter&&(c=b.RETURN,m=!1),u.keyCode===B.Escape&&(c=b.ESCAPE),u.keyCode===B.PageUp&&(c=b.PAGE_UP),u.keyCode===B.PageDown&&(c=b.PAGE_DOWN),u.keyCode===B.End&&(c=b.END),u.keyCode===B.Home&&(c=b.HOME),(u.keyCode===B.NumpadPlus||u.keyCode===171||u.keyCode===B.Equals)&&(c=b.PLUS,m=!1),(u.keyCode===B.NumpadMinus||u.keyCode===173||u.keyCode===B.Dash)&&(c=b.MINUS,m=!1),i.useArrowKeysToNavigate()&&(u.keyCode===B.LeftArrow&&(c=b.LEFT_ARROW),u.keyCode===B.UpArrow&&(c=b.UP_ARROW),u.keyCode===B.RightArrow&&(c=b.RIGHT_ARROW),u.keyCode===B.DownArrow&&(c=b.DOWN_ARROW))),c&&(m&&u.preventDefault(),this.extensionHost.publish(c))})}this.extensionHost.subscribe(w.EXIT_FULLSCREEN,()=>{this.isOverlayActive()&&this.extensionHost.publish(b.ESCAPE),this.extensionHost.publish(b.ESCAPE),this.extensionHost.publish(w.RESIZE)}),this.$element.append('<iframe id="commsFrame" style="display:none"></iframe>'),this.extensionHost.subscribeAll((a,u)=>{[w.LOAD,w.DROP,w.TOGGLE_FULLSCREEN,w.EXTERNAL_RESOURCE_OPENED,w.RELOAD].includes(a)||this.fire(a,u)}),this.extensionHost.subscribe(w.EXTERNAL_RESOURCE_OPENED,()=>{this.fire(w.EXTERNAL_RESOURCE_OPENED)}),this.extensionHost.subscribe(b.LOGIN_FAILED,()=>{this.showMessage(this.data.config.content.authorisationFailedMessage)}),this.extensionHost.subscribe(b.LOGIN,()=>{this.isLoggedIn=!0}),this.extensionHost.subscribe(b.LOGOUT,()=>{this.isLoggedIn=!1}),this.extensionHost.subscribe(b.BOOKMARK,()=>{this.bookmark()}),this.extensionHost.subscribe(b.CANVAS_INDEX_CHANGE,a=>{this.data.canvasIndex=a,this.lastCanvasIndex=this.helper.canvasIndex,this.helper.canvasIndex=a}),this.extensionHost.subscribe(b.CLOSE_LEFT_PANEL,()=>{i.$element.hasClass("loading")&&i.$element.removeClass("loading"),this.resize()}),this.extensionHost.subscribe(b.CLOSE_RIGHT_PANEL,()=>{this.resize()}),this.extensionHost.subscribe(b.COLLECTION_INDEX_CHANGE,a=>{this.data.collectionIndex=a}),this.extensionHost.subscribe(w.CREATED,()=>{this.isCreated=!0}),this.extensionHost.subscribe(b.ESCAPE,()=>{this.isFullScreen()&&!this.isOverlayActive()&&this.extensionHost.publish(w.TOGGLE_FULLSCREEN)}),this.extensionHost.subscribe(w.LOAD,()=>{setTimeout(()=>{this.extensionHost.publish(w.RESIZE),this.fire(w.LOAD,this.helper.getCurrentCanvas().id),this.$element.removeClass("loading")},100)}),this.extensionHost.subscribe(b.FEEDBACK,()=>{this.feedback()}),this.extensionHost.subscribe(b.FORBIDDEN,()=>{this.extensionHost.publish(b.OPEN_EXTERNAL_RESOURCE)}),this.extensionHost.subscribe(w.LOAD_FAILED,()=>{!i.lastCanvasIndex==null&&i.lastCanvasIndex!==i.helper.canvasIndex&&this.extensionHost.publish(b.CANVAS_INDEX_CHANGE,i.lastCanvasIndex)}),this.extensionHost.subscribe(b.MANIFEST_INDEX_CHANGE,a=>{this.data.manifestIndex=a}),this.extensionHost.subscribe(b.OPEN,()=>{let a=At.format(this.data.config.options.openTemplate,this.helper.manifestUri);window.open(a)}),this.extensionHost.subscribe(b.OPEN_LEFT_PANEL,()=>{this.$element.hasClass("loading")||this.resize()}),this.extensionHost.subscribe(b.OPEN_RIGHT_PANEL,()=>{this.$element.hasClass("loading")||this.resize()}),this.extensionHost.subscribe(b.RANGE_CHANGE,a=>{a?(this.data.rangeId=a.id,this.helper.rangeId=a.id):(this.data.rangeId=void 0,this.helper.rangeId=void 0)}),this.extensionHost.subscribe(b.RESOURCE_DEGRADED,a=>{N.handleDegraded(a)}),this.extensionHost.subscribe(b.SHOW_MESSAGE,a=>{this.showMessage(a)}),this.extensionHost.subscribe(b.SHOW_TERMS_OF_USE,()=>{let a=this.helper.getLicense();if(!a){let u=this.helper.getRequiredStatement();u&&u.value&&(a=u.value)}a&&this.showMessage(a)}),this.extensionHost.subscribe(w.TOGGLE_FULLSCREEN,()=>{let a=this.data.config.options.overrideFullScreen;this.extensionHost.isFullScreen=!this.extensionHost.isFullScreen,a||(z("#top").focus(),this.extensionHost.isFullScreen?this.$element.addClass("fullscreen"):this.$element.removeClass("fullscreen")),this.fire(w.TOGGLE_FULLSCREEN,{isFullScreen:this.extensionHost.isFullScreen,overrideFullScreen:a})}),this.shell=new It(this.$element),this.createModules(),this.extensionHost.publish(w.RESIZE),setTimeout(()=>{this.render(),this.extensionHost.publish(w.CREATED),this._setDefaultFocus()},1)}async loadConfig(i){let a=this.locales[i];if(!a)throw new Error("Unable to load config");return typeof a=="object"?a=JSON.parse(JSON.stringify(a)):typeof a=="function"&&(a=await a(),a=JSON.parse(JSON.stringify(a))),a}createModules(){this.$authDialogue=z('<div class="overlay auth" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$authDialogue),this.authDialogue=new mt(this.$authDialogue),this.$clickThroughDialogue=z('<div class="overlay clickthrough" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$clickThroughDialogue),this.clickThroughDialogue=new vt(this.$clickThroughDialogue),this.$restrictedDialogue=z('<div class="overlay login" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$restrictedDialogue),this.restrictedDialogue=new bt(this.$restrictedDialogue),this.$loginDialogue=z('<div class="overlay login" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$loginDialogue),this.loginDialogue=new Et(this.$loginDialogue)}_setDefaultFocus(){setTimeout(()=>{this.data.config.options.allowStealFocus&&z("[tabindex=0]").focus()},1)}width(){return this.$element.width()}height(){return this.$element.height()}exitFullScreen(){this.extensionHost.publish(w.EXIT_FULLSCREEN)}fire(i,...a){this.data.debug&&console.log(i,arguments[1]),this.extensionHost.fire(i,arguments[1])}redirect(i){this.fire(b.REDIRECT,i)}refresh(){this.fire(b.REFRESH,null)}render(){if((!this.isCreated||this.data.collectionIndex!==this.helper.collectionIndex)&&this.extensionHost.publish(b.COLLECTION_INDEX_CHANGE,this.data.collectionIndex),(!this.isCreated||this.data.manifestIndex!==this.helper.manifestIndex)&&this.data.iiifManifestId!==void 0&&this.extensionHost.publish(b.MANIFEST_INDEX_CHANGE,this.data.manifestIndex),(!this.isCreated||this.data.canvasIndex!==this.helper.canvasIndex)&&(this.data.canvasIndex===void 0&&(this.data.canvasIndex=0),this.data.canvasId&&(this.data.canvasIndex=this.helper.canvasIndex),this.extensionHost.publish(b.CANVAS_INDEX_CHANGE,this.data.canvasIndex)),(!this.isCreated||this.data.rangeId!==this.helper.rangeId)&&this.data.rangeId){let i=this.helper.getRangeById(this.data.rangeId);i?this.extensionHost.publish(b.RANGE_CHANGE,i):console.warn("range id not found:",this.data.rangeId)}}_initLocales(){let i=this.data.config.localisation.locales.slice(0),a=this.data.locales,u=[];a?(a.forEach(m=>{let o=i.filter(g=>g.name===m.name);if(o.length){var v=o[0];m.label&&(v.label=m.label),v.added=!0,u.push(v)}}),R.getBool(this.data.config.options.limitLocales,!1)||i.forEach(m=>{m.added||u.push(m),delete m.added}),this.data.locales=u):console.warn("No locales configured")}_parseMetrics(){let i=this.data.config.options.metrics;if(i)for(let a=0;a<i.length;a++){let u=i[a];this.metrics.push(u)}}_updateMetric(){setTimeout(()=>{for(let a=this.metrics.length-1;a>=0;a--){let u=this.metrics[a];if(window.innerWidth>=u.minWidth){if(this.metric!==u.type){this.metric=u.type;for(var i=0;i<this.metrics.length;i++)this.$element.removeClass(this.metrics[i].type);this.$element.addClass(u.type),this.extensionHost.publish(b.METRIC_CHANGE)}break}}},1)}resize(){this._updateMetric(),this.extensionHost.publish(w.RESIZE)}reload(i){this.extensionHost.publish(w.RELOAD,i)}isSeeAlsoEnabled(){return this.data.config.options.seeAlsoEnabled!==!1}getShareUrl(){if(this.data.embedded){if(this.helper.hasRelatedPage()){var i=this.helper.getRelated();return i&&i.length&&(i=i[0]),i["@id"]}let a=this.helper.manifest,u=a&&a.getHomepage();if(u)return u}else return Y.isInIFrame()?parent.document.location.href:document.location.href;return null}getIIIFShareUrl(i=!1){let a;return i&&(this.helper.manifest?a=this.helper.manifest.id:a=this.helper.manifestUri),`${a}?manifest=${a}`}getDomain(){return G.getUrlParts(this.helper.manifestUri).host}getAppUri(){return window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"")+"/uv.html"}getSettings(){if(R.getBool(this.data.config.options.saveUserSettings,!1)){let i=D.get("uv.settings",lt.LOCAL);if(i)return z.extend(this.data.config.options,i.value)}return this.data.config.options}updateSettings(i){if(R.getBool(this.data.config.options.saveUserSettings,!1)){let a=D.get("uv.settings",lt.LOCAL);a&&(i=z.extend(a.value,i)),D.set("uv.settings",i,31536e4,lt.LOCAL)}this.data.config.options=z.extend(this.data.config.options,i)}getLocale(){return this.helper.options.locale}getSharePreview(){let i=this.helper.getLabel(),a=this.helper.getCurrentCanvas(),u=a.getProperty("thumbnail");return(!u||typeof u!="string")&&(u=a.getCanonicalImageUri(this.data.config.options.bookmarkThumbWidth)),{title:i,image:u}}getPagedIndices(i=this.helper.canvasIndex){return[i]}getCurrentCanvases(){let i=this.getPagedIndices(this.helper.canvasIndex),a=[];for(let u=0;u<i.length;u++){let c=i[u],m=this.helper.getCanvasByIndex(c);m&&a.push(m)}return a}getCanvasLabels(i){let a=this.getPagedIndices(),u="";if(a.length===1)u=i;else for(let c=1;c<=a.length;c++)u.length&&(u+=","),u+=i+" "+c;return u}getCurrentCanvasRange(){return this.helper.getCanvasRange(this.helper.getCurrentCanvas())}getExternalResources(i){let a=this.getPagedIndices(),u=[];a.forEach(o=>{let v=this.helper.getCanvasByIndex(o),g;if(v.externalResource?g=v.externalResource:g=new Mt(v,{authApiVersion:this.data.config.options.authAPIVersion}),i){let l=i.find(p=>p.dataUri===g.dataUri);l?u.push(l):u.push(g)}else u.push(g)});let c=this.data.config.options.tokenStorage;return this.data.config.options.authAPIVersion===1?new Promise(o=>{let v={locale:this.helper.options.locale};ot.loadExternalResources(u,c,v).then(g=>{this.resources=g.map(l=>this._prepareResourceData(l)),o(this.resources)})}):new Promise(o=>{N.loadExternalResources(u,c).then(v=>{this.resources=v.map(g=>this._prepareResourceData(g)),o(this.resources)})})}_prepareResourceData(i){return i.data.hasServiceDescriptor=i.hasServiceDescriptor(),i.data.index=i.index,St.toPlainObject(i.data)}getMediaFormats(i){let a=i.getContent();return a&&a.length?a[0].getBody():[{id:i.id,type:i.getType(),getFormat:function(){return""}}]}viewCanvas(i){if(this.helper.isCanvasIndexOutOfRange(i)){this.showMessage(this.data.config.content.canvasIndexOutOfRange);return}this.extensionHost.publish(b.OPEN_EXTERNAL_RESOURCE)}showMessage(i,a,u,c){this.closeActiveDialogue(),this.extensionHost.publish(b.SHOW_GENERIC_DIALOGUE,{message:i,acceptCallback:a,buttonText:u,allowClose:c})}closeActiveDialogue(){this.extensionHost.publish(b.CLOSE_ACTIVE_DIALOGUE)}isOverlayActive(){return F(this.shell.$overlays)}isDesktopMetric(){return this.metric==="lg"||this.metric==="xl"}isMobileMetric(){return this.metric==="sm"||this.metric==="md"}viewManifest(i){let a={};a.iiifManifestId=this.helper.manifestUri,a.collectionIndex=this.helper.getCollectionIndex(i),a.manifestIndex=i.index,a.canvasIndex=0,this.reload(a)}viewCollection(i){let a={};a.iiifManifestId=i.parentCollection?i.parentCollection.id:this.helper.manifestUri,a.collectionIndex=i.index,a.manifestIndex=0,a.canvasIndex=0,this.reload(a)}isFullScreen(){return this.extensionHost.isFullScreen}isHeaderPanelEnabled(){return R.getBool(this.data.config.options.headerPanelEnabled,!0)}isLeftPanelEnabled(){if(R.getBool(this.data.config.options.leftPanelEnabled,!0)){if(this.helper.hasParentCollection())return!0;if(this.helper.isMultiCanvas()){let i=this.helper.getViewingHint();if(!i||i&&i!==Dt.ViewingHint.CONTINUOUS)return!0}}return!1}isRightPanelEnabled(){return R.getBool(this.data.config.options.rightPanelEnabled,!0)}isFooterPanelEnabled(){return R.getBool(this.data.config.options.footerPanelEnabled,!0)}isMobile(){let i=navigator.userAgent||navigator.vendor||window.opera;return/(android|bb\d+|meego).+mobile|avantgo|bada\/|android|ipad|playbook|silk|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(i)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(i.substr(0,4))}useArrowKeysToNavigate(){return R.getBool(this.data.config.options.useArrowKeysToNavigate,!0)}bookmark(){}feedback(){this.fire(b.FEEDBACK,this.data)}getAlternateLocale(){let i=null;return this.data.locales&&this.data.locales.length>1&&(i=this.data.locales[1]),i}getSerializedLocales(){return this.data.locales?this.serializeLocales(this.data.locales):null}serializeLocales(i){let a="";for(let u=0;u<i.length;u++){let c=i[u];u>0&&(a+=","),a+=c.name,c.label&&(a+=":"+c.label)}return a}changeLocale(i){let a={};if(this.data.locales){a.locales=this.data.locales.slice(0);let u=a.locales.findIndex(m=>m.name===i),c=0;a.locales.splice(c,0,a.locales.splice(u,1)[0]),this.reload(a)}}dispose(){this.store?.destroy()}},Gt=class{constructor(){this.dataBrowser=[{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer"},{string:navigator.userAgent,subString:"Trident",identity:"Explorer"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.userAgent,subString:"Safari",identity:"Safari"},{string:navigator.userAgent,subString:"Opera",identity:"Opera"}]}init(){this.browser=this.searchString(this.dataBrowser)||"Other",this.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||"Unknown",this.browser=="Explorer"&&this.version=="7"&&navigator.userAgent.match(/Trident/i)&&(this.version=this.searchVersionIE())}searchString(i){for(var a=0;a<i.length;a++){var u=i[a].string;if(this.versionSearchString=i[a].subString,u.indexOf(i[a].subString)!=-1)return i[a].identity}}searchVersion(i){var a=i.indexOf(this.versionSearchString);if(a!=-1)return parseFloat(i.substring(a+this.versionSearchString.length+1))}searchVersionIE(){var i=navigator.userAgent.toString().toLowerCase(),a=/(trident)(?:.*rv:([\w.]+))?/.exec(i)||/(msie) ([\w.]+)/.exec(i)||["",null,-1],u="unknown";return a!==null&&a.length===3&&a[2]&&(u=a[2].split(".")[0]),u}};var Q=window.$,Yt=class extends U{constructor(i){super(i)}create(){this.setConfig("footerPanel"),super.create(),this.extensionHost.subscribe(w.TOGGLE_FULLSCREEN,()=>{this.updateFullScreenButton(),this.extensionHost.isFullScreen||setTimeout(()=>{this.resize()},1001)}),this.extensionHost.subscribe(b.METRIC_CHANGE,()=>{this.updateMinimisedButtons(),this.updateMoreInfoButton()}),this.extensionHost.subscribe(b.SETTINGS_CHANGE,()=>{this.updateDownloadButton()}),this.$options=Q('<div class="options"></div>'),this.$element.append(this.$options),this.$feedbackButton=Q(`
          <button class="feedback btn imageBtn" title="${this.content.feedback}">
            <i class="uv-icon uv-icon-feedback" aria-hidden="true"></i>
            <span class="sr-only">${this.content.feedback}</span>
          </button>
        `),this.$options.prepend(this.$feedbackButton),this.$openButton=Q(`
          <button class="open btn imageBtn" title="${this.content.open}">
            <i class="uv-icon-open" aria-hidden="true"></i>
            <span class="sr-only">${this.content.open}</span>
          </button>
        `),this.$options.prepend(this.$openButton),this.$bookmarkButton=Q(`
          <button class="bookmark btn imageBtn" title="${this.content.bookmark}">
            <i class="uv-icon uv-icon-bookmark" aria-hidden="true"></i>
            <span class="sr-only">${this.content.bookmark}</span>
          </button>
        `),this.$options.prepend(this.$bookmarkButton),this.$shareButton=Q(`
          <button class="share btn imageBtn" title="${this.content.share}">
            <i class="uv-icon uv-icon-share" aria-hidden="true"></i>
            <span class="sr-only">${this.content.share}</span>
          </button>
        `),this.$options.append(this.$shareButton),this.$embedButton=Q(`
          <button class="embed btn imageBtn" title="${this.content.embed}">
            <i class="uv-icon uv-icon-embed" aria-hidden="true"></i>
            <span class="sr-only">${this.content.embed}</span>
          </button>
        `),this.$options.append(this.$embedButton),this.$downloadButton=Q(`
          <button class="download btn imageBtn" title="${this.content.download}" id="download-btn">
            <i class="uv-icon uv-icon-download" aria-hidden="true"></i>
            <span class="sr-only">${this.content.download}</span>
          </button>
        `),this.$options.prepend(this.$downloadButton),this.$moreInfoButton=Q(`
          <button class="moreInfo btn imageBtn" title="${this.content.moreInfo}">
            <i class="uv-icon uv-icon-more-info" aria-hidden="true"></i>
            <span class="sr-only">${this.content.moreInfo}</span>
          </button>
        `),this.$options.prepend(this.$moreInfoButton),this.$fullScreenBtn=Q(`
          <button class="fullScreen btn imageBtn" title="${this.content.fullScreen}">
            <i class="uv-icon uv-icon-fullscreen" aria-hidden="true"></i>
            <span class="sr-only">${this.content.fullScreen}</span>
          </button>
        `),this.$options.append(this.$fullScreenBtn),this.$openButton.onPressed(()=>{this.extensionHost.publish(b.OPEN)}),this.$feedbackButton.onPressed(()=>{this.extensionHost.publish(b.FEEDBACK)}),this.$bookmarkButton.onPressed(()=>{this.extensionHost.publish(b.BOOKMARK)}),this.$shareButton.onPressed(()=>{this.extensionHost.publish(b.SHOW_SHARE_DIALOGUE,this.$shareButton)}),this.$embedButton.onPressed(()=>{this.extensionHost.publish(b.SHOW_EMBED_DIALOGUE,this.$embedButton)}),this.$downloadButton.onPressed(()=>{this.extensionHost.publish(b.SHOW_DOWNLOAD_DIALOGUE,this.$downloadButton)}),this.$moreInfoButton.onPressed(()=>{this.extensionHost.publish(b.SHOW_MOREINFO_DIALOGUE,this.$moreInfoButton)}),this.onAccessibleClick(this.$fullScreenBtn,i=>{i.preventDefault(),this.extensionHost.publish(w.TOGGLE_FULLSCREEN)},!0),R.getBool(this.options.embedEnabled,!0)||this.$embedButton.hide(),this.updateMoreInfoButton(),this.updateOpenButton(),this.updateFeedbackButton(),this.updateBookmarkButton(),this.updateEmbedButton(),this.updateDownloadButton(),this.updateFullScreenButton(),this.updateShareButton(),this.updateMinimisedButtons()}updateMinimisedButtons(){if(R.getBool(this.options.minimiseButtons,!1)){this.$options.addClass("minimiseButtons");return}this.extension.isDesktopMetric()?this.$options.removeClass("minimiseButtons"):this.$options.addClass("minimiseButtons")}updateMoreInfoButton(){}updateOpenButton(){R.getBool(this.options.openEnabled,!1)&&Y.isInIFrame()?this.$openButton.show():this.$openButton.hide()}updateFullScreenButton(){if(!R.getBool(this.options.fullscreenEnabled,!0)||!Y.supportsFullscreen()){this.$fullScreenBtn.hide();return}this.extension.isFullScreen()?(this.$fullScreenBtn.switchClass("fullScreen","exitFullscreen"),this.$fullScreenBtn.find("i").switchClass("uv-icon-fullscreen","uv-icon-exit-fullscreen"),this.$fullScreenBtn.attr("title",this.content.exitFullScreen),Q(this.$fullScreenBtn[0].firstChild.nextSibling.nextSibling).replaceWith(this.content.exitFullScreen)):(this.$fullScreenBtn.switchClass("exitFullscreen","fullScreen"),this.$fullScreenBtn.find("i").switchClass("uv-icon-exit-fullscreen","uv-icon-fullscreen"),this.$fullScreenBtn.attr("title",this.content.fullScreen),Q(this.$fullScreenBtn[0].firstChild.nextSibling.nextSibling).replaceWith(this.content.fullScreen))}updateEmbedButton(){this.extension.helper.isUIEnabled("embed")&&R.getBool(this.options.embedEnabled,!1)?this.extension.isMobile()||this.$embedButton.show():this.$embedButton.hide()}updateShareButton(){this.extension.helper.isUIEnabled("share")&&R.getBool(this.options.shareEnabled,!0)?this.$shareButton.show():this.$shareButton.hide()}updateDownloadButton(){R.getBool(this.options.downloadEnabled,!0)?this.$downloadButton.show():this.$downloadButton.hide()}updateFeedbackButton(){R.getBool(this.options.feedbackEnabled,!1)?this.$feedbackButton.show():this.$feedbackButton.hide()}updateBookmarkButton(){R.getBool(this.options.bookmarkEnabled,!1)?this.$bookmarkButton.show():this.$bookmarkButton.hide()}resize(){super.resize()}};var ct=class{constructor(i,a){this.message=i;this.actions=a}};var $t=class{constructor(){}};var xt=class{constructor(i){this.extension=i}Get(i){switch(i.informationType){case q.AUTH_CORS_ERROR:return new ct(this.extension.data.config.content.authCORSError,[]);case q.DEGRADED_RESOURCE:let a=[],u=new $t,c;i.param.loginService?c=i.param.loginService.getConfirmLabel():c=i.param.kioskService.getConfirmLabel(),c||(c=this.extension.data.config.content.fallbackDegradedLabel||"login"),u.label=c;let m=i.param;u.action=()=>{i.param.loginService&&(m.authHoldingPage=window.open("","_blank")),this.extension.extensionHost.publish(b.HIDE_INFORMATION),this.extension.extensionHost.publish(b.OPEN_EXTERNAL_RESOURCE,[[m]])},a.push(u);let o;return i.param.loginService?o=i.param.loginService.getServiceLabel():o=i.param.kioskService.getServiceLabel(),o||(o=this.extension.data.config.content.fallbackDegradedMessage),new ct(o,a)}}};var tt=window.$,Xt=class extends U{constructor(i){super(i,!1,!1)}create(){this.setConfig("headerPanel"),super.create(),this.extensionHost.subscribe(b.SHOW_INFORMATION,i=>{this.showInformation(Array.isArray(i)?i[0]:i)}),this.extensionHost.subscribe(b.HIDE_INFORMATION,()=>{this.hideInformation()}),this.$options=tt('<div class="options"></div>'),this.$element.append(this.$options),this.$centerOptions=tt('<div class="centerOptions"></div>'),this.$options.append(this.$centerOptions),this.$rightOptions=tt('<div class="rightOptions"></div>'),this.$options.append(this.$rightOptions),this.$localeToggleButton=tt('<a class="localeToggle" tabindex="0"></a>'),this.$rightOptions.append(this.$localeToggleButton),this.$settingsButton=tt(`
          <button class="btn imageBtn settings" tabindex="0" title="${this.content.settings}">
            <i class="uv-icon-settings" aria-hidden="true"></i>
          </button>
        `),this.$settingsButton.attr("title",this.content.settings),this.$rightOptions.append(this.$settingsButton),this.$informationBox=tt('<div class="informationBox" aria-hidden="true">                                     <div class="message"></div>                                     <div class="actions"></div>                                     <button type="button" class="close" aria-label="Close">                                         <span aria-hidden="true">&#215;</span>                                    </button>                                   </div>'),this.$element.append(this.$informationBox),this.$informationBox.hide(),this.$informationBox.find(".close").attr("title",this.content.close),this.$informationBox.find(".close").on("click",i=>{i.preventDefault(),this.extensionHost.publish(b.HIDE_INFORMATION)}),this.$localeToggleButton.on("click",()=>{this.extension.changeLocale(String(this.$localeToggleButton.data("locale")))}),this.$settingsButton.onPressed(()=>{this.extensionHost.publish(b.SHOW_SETTINGS_DIALOGUE,this.$settingsButton)}),R.getBool(this.options.centerOptionsEnabled,!0)||this.$centerOptions.hide(),this.updateLocaleToggle(),this.updateSettingsButton()}updateLocaleToggle(){if(!this.localeToggleIsVisible()){this.$localeToggleButton.hide();return}let i=this.extension.getAlternateLocale(),a=i.name.split("-")[0].toUpperCase();this.$localeToggleButton.data("locale",i.name),this.$localeToggleButton.attr("title",i.label),this.$localeToggleButton.text(a)}updateSettingsButton(){R.getBool(this.options.settingsButtonEnabled,!0)?this.$settingsButton.show():this.$settingsButton.hide()}localeToggleIsVisible(){let i=this.extension.data.locales;return i?i.length>1&&R.getBool(this.options.localeToggleEnabled,!1):!1}showInformation(i){let a=new xt(this.extension);if(this.information=a.Get(i),!!this.information){var u=this.$informationBox.find(".message");u.html(this.information.message).find("a").attr("target","_top");var c=this.$informationBox.find(".actions");c.empty();for(let m=0;m<this.information.actions.length;m++){let o=this.information.actions[m],v=tt('<a href="#" class="btn btn-default">'+o.label+"</a>");v.on("click",o.action),c.append(v)}this.extensionHost.publish(b.MESSAGE_DISPLAYED,this.information),this.$informationBox.attr("aria-hidden","false"),this.$informationBox.show(),this.$element.addClass("showInformation"),this.extension.resize()}}hideInformation(){this.$element.removeClass("showInformation"),this.$informationBox.attr("aria-hidden","true"),this.$informationBox.hide(),this.extension.resize()}getSettings(){return this.extension.getSettings()}updateSettings(i){this.extension.updateSettings(i),this.extensionHost.publish(b.UPDATE_SETTINGS,i)}resize(){super.resize();let a=this.$element.width()/2,u=this.$centerOptions.outerWidth(),c=a-u/2;if(this.$centerOptions.css({left:c}),F(this.$informationBox)){let m=this.$informationBox.find(".actions"),o=this.$informationBox.find(".message");o.width(Math.floor(this.$element.width())-Math.ceil(o.horizontalMargins())-Math.ceil(m.outerWidth(!0))-Math.ceil(this.$informationBox.find(".close").outerWidth(!0))-2),this.information&&o.text(this.information.message)}this.extension.width()<this.extension.data.config.options.minWidthBreakPoint?this.localeToggleIsVisible()&&this.$localeToggleButton.hide():this.localeToggleIsVisible()&&this.$localeToggleButton.show()}};var X=window.$,rt=class extends U{constructor(i){super(i,!1,!0);this.isExpanded=!1;this.isFullyExpanded=!1;this.isUnopened=!0;this.autoToggled=!1;this.expandFullEnabled=!0;this.reducedAnimation=!1}create(){super.create(),this.$top=X('<div class="top"></div>'),this.$element.append(this.$top),this.$title=X('<h2 class="title"></h2>'),this.$top.append(this.$title),this.$expandFullButton=X('<a class="expandFullButton" tabindex="0"></a>'),this.$top.append(this.$expandFullButton),R.getBool(this.config.options.expandFullEnabled,!0)||this.$expandFullButton.hide(),this.$collapseButton=X('<div role="button" class="collapseButton" tabindex="0"></div>'),this.$collapseButton.prop("title",this.content.collapse),this.$top.append(this.$collapseButton),this.$closed=X('<div class="closed"></div>'),this.$element.append(this.$closed),this.$expandButton=X('<a role="button" class="expandButton" tabindex="0"></a>'),this.$expandButton.prop("title",this.content.expand),this.$closed.append(this.$expandButton),this.$closedTitle=X('<a class="title"></a>'),this.$closed.append(this.$closedTitle),this.$main=X('<div class="main"></div>'),this.$element.append(this.$main),this.onAccessibleClick(this.$expandButton,()=>{this.toggle()}),this.$expandFullButton.on("click",()=>{this.expandFull()}),this.$closedTitle.on("click",()=>{this.toggle()}),this.$title.on("click",()=>{this.isFullyExpanded?this.collapseFull():this.toggle()}),this.onAccessibleClick(this.$collapseButton,()=>{this.isFullyExpanded?this.collapseFull():this.toggle()}),this.$top.hide(),this.$main.hide(),this.extensionHost.subscribe(b.SETTINGS_CHANGE,i=>{this.reducedAnimation=i.reducedAnimation||!1})}init(){super.init()}setTitle(i){this.$title.text(i),this.$closedTitle.text(i)}toggle(i){i?this.autoToggled=!0:this.autoToggled=!1,this.isExpanded&&(this.$top.attr("aria-hidden","true"),this.$main.attr("aria-hidden","true"),this.$closed.attr("aria-hidden","false"),this.$top.hide(),this.$main.hide(),this.$closed.show()),this.reducedAnimation?(this.$element.css("width",this.getTargetWidth()),this.$element.css("left",this.getTargetLeft()),this.toggled()):this.$element.stop().animate({width:this.getTargetWidth(),left:this.getTargetLeft()},this.options.panelAnimationDuration,()=>{this.toggled()})}toggled(){this.toggleStart(),this.isExpanded=!this.isExpanded,this.isExpanded&&(this.$top.attr("aria-hidden","false"),this.$main.attr("aria-hidden","false"),this.$closed.attr("aria-hidden","true"),this.$closed.hide(),this.$top.show(),this.$main.show()),this.toggleFinish(),this.isUnopened=!1}expandFull(){this.isExpanded||this.toggled();var i=this.getFullTargetWidth(),a=this.getFullTargetLeft();this.expandFullStart(),this.$element.stop().animate({width:i,left:a},this.options.panelAnimationDuration,()=>{this.expandFullFinish()})}collapseFull(){var i=this.getTargetWidth(),a=this.getTargetLeft();this.collapseFullStart(),this.$element.stop().animate({width:i,left:a},this.options.panelAnimationDuration,()=>{this.collapseFullFinish()})}getTargetWidth(){return 0}getTargetLeft(){return 0}getFullTargetWidth(){return 0}getFullTargetLeft(){return 0}toggleStart(){}toggleFinish(){this.isExpanded&&!this.autoToggled?this.focusCollapseButton():this.focusExpandButton()}expandFullStart(){}expandFullFinish(){this.isFullyExpanded=!0,this.$expandFullButton.hide(),this.focusCollapseButton()}collapseFullStart(){}collapseFullFinish(){this.isFullyExpanded=!1,this.expandFullEnabled&&this.$expandFullButton.show(),this.focusExpandFullButton()}focusExpandButton(){setTimeout(()=>{this.$expandButton.focus()},1)}focusExpandFullButton(){setTimeout(()=>{this.$expandFullButton.focus()},1)}focusCollapseButton(){setTimeout(()=>{this.$collapseButton.focus()},1)}resize(){super.resize(),this.$main.height(this.$element.parent().height()-this.$top.outerHeight(!0))}};var yt=class extends rt{constructor(i){super(i)}create(){super.create(),this.$element.width(this.options.panelCollapsedWidth)}init(){super.init(),R.getBool(this.extension.getSettings().rightPanelOpen,this.options.panelOpen)&&this.toggle(!0),this.extensionHost.subscribe(b.TOGGLE_EXPAND_RIGHT_PANEL,()=>{this.isFullyExpanded?this.collapseFull():this.expandFull()})}getTargetWidth(){return this.isExpanded?this.options.panelCollapsedWidth:this.options.panelExpandedWidth}getTargetLeft(){return this.isExpanded?this.$element.parent().width()-this.options.panelCollapsedWidth:this.$element.parent().width()-this.options.panelExpandedWidth}toggleFinish(){super.toggleFinish(),this.isExpanded?this.extensionHost.publish(b.OPEN_RIGHT_PANEL):this.extensionHost.publish(b.CLOSE_RIGHT_PANEL),this.extension.updateSettings({rightPanelOpen:this.isExpanded})}resize(){super.resize(),this.$element.css({left:Math.floor(this.$element.parent().width()-this.$element.outerWidth())})}};var ht=et(Vt()),Zt=window.$,Kt=class extends yt{constructor(i){super(i)}create(){this.setConfig("moreInfoRightPanel"),super.create(),this.extensionHost.subscribe(b.CANVAS_INDEX_CHANGE,()=>{this.databind()}),this.extensionHost.subscribe(b.RANGE_CHANGE,()=>{this.databind()}),this.setTitle(this.config.content.title),this.$metadata=Zt('<div class="iiif-metadata-component"></div>'),this.$main.append(this.$metadata),this.metadataComponent=new ht.MetadataComponent({target:this.$metadata[0],data:this._getData()}),this.metadataComponent.on("iiifViewerLinkClicked",i=>{let a=G.getHashParameterFromString("rid",i);if(a){let c=this.extension.helper.getRangeById(a);c&&this.extensionHost.publish(b.RANGE_CHANGE,c)}let u=G.getHashParameterFromString("t",i);if(u!==null){let c=Number(u);Number.isNaN(c)||this.extensionHost.publish(b.CURRENT_TIME_CHANGE,c)}},!1)}toggleFinish(){super.toggleFinish(),this.databind()}databind(){this.metadataComponent.set(this._getData())}_getCurrentRange(){return this.extension.helper.getCurrentRange()}_getData(){let i=this.extension.getCurrentCanvases();return{canvasDisplayOrder:this.config.options.canvasDisplayOrder,canvases:i,canvasExclude:this.config.options.canvasExclude,canvasLabels:this.extension.getCanvasLabels(this.content.page),content:this.config.content,copiedMessageDuration:2e3,copyToClipboardEnabled:R.getBool(this.config.options.copyToClipboardEnabled,!1),helper:this.extension.helper,licenseFormatter:new wt(this.config.license?this.config.license:{}),limit:this.config.options.textLimit||4,limitType:ht.LimitType.LINES,limitToRange:R.getBool(this.config.options.limitToRange,!1),manifestDisplayOrder:this.config.options.manifestDisplayOrder,manifestExclude:this.config.options.manifestExclude,range:this._getCurrentRange(),rtlLanguageCodes:this.config.options.rtlLanguageCodes,sanitizer:a=>V(a),showAllLanguages:this.config.options.showAllLanguages}}resize(){super.resize(),this.$main.height(this.$element.height()-this.$top.height()-this.$main.verticalMargins())}};var nt;(function(l){l[l.TOP_LEFT=0]="TOP_LEFT",l[l.TOP_CENTER=1]="TOP_CENTER",l[l.TOP_RIGHT=2]="TOP_RIGHT",l[l.CENTER_LEFT=3]="CENTER_LEFT",l[l.CENTER=4]="CENTER",l[l.CENTER_RIGHT=5]="CENTER_RIGHT",l[l.BOTTOM_LEFT=6]="BOTTOM_LEFT",l[l.BOTTOM_CENTER=7]="BOTTOM_CENTER",l[l.BOTTOM_RIGHT=8]="BOTTOM_RIGHT"})(nt||(nt={}));var dt=window.$,te=class extends U{constructor(i){super(i,!1,!0);this.subtitleExpanded=!1;this.isAttributionOpen=!1;this.attributionPosition=nt.BOTTOM_LEFT;this.isAttributionLoaded=!1}create(){super.create(),this.$title=dt('<h1 class="title"></h1>'),this.$element.append(this.$title),this.$subtitle=dt(`<div class="subtitle">
                                <div class="wrapper">
                                    <button type="button" class="expand-btn" aria-label="Expand">
                                        <span aria-hidden="true">+</span>
                                    </button>
                                    <span class="text"></span>
                                </div>
                            </div>`),this.$element.append(this.$subtitle),this.$subtitleWrapper=this.$subtitle.find(".wrapper"),this.$subtitleExpand=this.$subtitle.find(".expand-btn"),this.$subtitleText=this.$subtitle.find(".text"),this.$content=dt('<div id="content" class="content"></div>'),this.$element.append(this.$content),this.$attribution=dt(`
                                <div class="attribution">
                                  <div class="header">
                                    <div class="title"></div>
                                    <button type="button" class="close" aria-label="Close">
                                      <span aria-hidden="true">&#215;</span>
                                    </button>
                                  </div>
                                  <div class="main">
                                    <div class="attribution-text"></div>
                                    <div class="license"></div>
                                    <div class="logo"></div>
                                  </div>
                                </div>
        `),this.$attribution.find(".header .title").text(this.content.attribution),this.$content.append(this.$attribution),this.closeAttribution(),this.$closeAttributionButton=this.$attribution.find(".header .close"),this.$closeAttributionButton.on("click",i=>{i.preventDefault(),this.closeAttribution()}),this.$subtitleExpand.on("click",i=>{i.preventDefault(),this.subtitleExpanded=!this.subtitleExpanded,this.subtitleExpanded?(this.$subtitleWrapper.addClass("expanded"),this.$subtitleExpand.text("-")):(this.$subtitleWrapper.removeClass("expanded"),this.$subtitleExpand.text("+")),this.resize()}),R.getBool(this.options.titleEnabled,!0)?this.$title.show():this.$title.hide(),R.getBool(this.options.subtitleEnabled,!1)?this.$subtitle.show():this.$subtitle.hide(),this.whenResized(()=>{this.updateRequiredStatement()}),this.extensionHost.subscribe(b.RANGE_CHANGE,()=>{this.updateRequiredStatement()}),this.extensionHost.subscribe(b.CANVAS_INDEX_CHANGE,()=>{this.updateRequiredStatement()}),this.extensionHost.subscribe(b.MANIFEST_INDEX_CHANGE,()=>{this.updateRequiredStatement()})}openAttribution(){this.$attribution.show(),this.isAttributionOpen=!0}closeAttribution(){this.$attribution.hide(),this.isAttributionOpen=!1}updateRequiredStatement(){if(this.isAttributionLoaded)return;let i=R.getBool(this.config.options.mostSpecificRequiredStatement,!1),a=i?this.extension.helper.getMostSpecificRequiredStatement():this.extension.helper.getRequiredStatement(),u=R.getBool(this.options.requiredStatementEnabled,!0);if(!a||!a.value||!u)return;this.openAttribution();let c=this.$attribution.find(".title"),m=this.$attribution.find(".attribution-text"),o=this.$attribution.find(".license"),v=this.$attribution.find(".logo");if(a.label){let g=V(a.label);c.html(g)}else c.text(this.content.attribution);if(a.value){let g=V(a.value);m.html(g);let l=()=>this.resize();m.find("img").one("load",()=>{this.resize()}).each(function(){this.complete&&l()}),m.find("img").one("error",()=>{l()}),m.targetBlank()}o.hide(),v.hide(),this.resize(),i||(this.isAttributionLoaded=!0)}resize(){super.resize();let i=F(this.extension.shell.$leftPanel)?Math.floor(this.extension.shell.$leftPanel.width()):0,a=F(this.extension.shell.$rightPanel)?Math.floor(this.extension.shell.$rightPanel.width()):0,u=Math.floor(this.$element.parent().width()-i-a);this.$element.css({left:i,width:u});let c,m;this.options&&this.options.titleEnabled===!1||!F(this.$title)?c=0:c=this.$title.outerHeight(!0),this.options&&this.options.subtitleEnabled===!1||!F(this.$subtitle)?m=0:m=this.$subtitle.outerHeight(!0),this.$content.height(this.$element.height()-c-m),this.$content.width(this.$element.width());let o=this.$attribution.find(".attribution-text");if(o.css("maxHeight",`calc(${this.$content.height()}px - 100px)`),o.css("overflow-y","auto"),this.$attribution&&this.isAttributionOpen){switch(this.attributionPosition){case nt.BOTTOM_LEFT:this.$attribution.css("bottom",0),this.$attribution.css("left",0);break;case nt.BOTTOM_RIGHT:this.$attribution.css("bottom",0),this.$attribution.css("right",0);break}this.$content.width()<=this.$attribution.width()?this.$attribution.hide():this.$attribution.show()}this.subtitle&&this.options.subtitleEnabled?(this.$subtitleText.html(V(this.subtitle.replace(/<br\s*[\/]?>/gi,"; "))),this.$subtitleText.removeClass("elided"),this.$subtitle.show(),this.$subtitleWrapper.css("max-height",this.$content.height()+this.$subtitle.outerHeight()),this.$subtitleWrapper.width(this.$content.width()),this.subtitleExpanded?this.$subtitleText.width(this.$content.width()-this.$subtitleText.horizontalMargins()-2):(this.$subtitleText.width("auto"),this.$subtitleWrapper.width("auto"),this.$subtitleExpand.hide(),this.$subtitleText.width()>this.$content.width()&&(this.$subtitleExpand.show(),this.$subtitleText.addClass("elided"),this.$subtitleText.width(this.$content.width()-(this.$subtitleExpand.outerWidth()+this.$subtitleText.horizontalMargins()))))):this.$subtitle.hide()}};var ee=class extends rt{constructor(i){super(i)}create(){super.create(),this.$element.width(this.options.panelCollapsedWidth),this.extensionHost.subscribe(b.TOGGLE_EXPAND_LEFT_PANEL,()=>{this.isFullyExpanded?this.collapseFull():this.expandFull()})}init(){super.init(),R.getBool(this.extension.getSettings().leftPanelOpen,this.options.panelOpen)&&this.toggle(!0)}getTargetWidth(){return this.isFullyExpanded||!this.isExpanded?this.options.panelExpandedWidth:this.options.panelCollapsedWidth}getFullTargetWidth(){return this.$element.parent().width()}toggleFinish(){super.toggleFinish(),this.isExpanded?this.extensionHost.publish(b.OPEN_LEFT_PANEL):this.extensionHost.publish(b.CLOSE_LEFT_PANEL),this.extension.updateSettings({leftPanelOpen:this.isExpanded})}resize(){super.resize(),this.isFullyExpanded&&this.$element.width(this.$element.parent().width())}};var W=window.$,ie=class extends k{constructor(i){super(i)}create(){this.setConfig("settingsDialogue"),super.create(),this.openCommand=b.SHOW_SETTINGS_DIALOGUE,this.closeCommand=b.HIDE_SETTINGS_DIALOGUE;let i;this.extensionHost.subscribe(this.openCommand,a=>{i=a,this.open()}),this.extensionHost.subscribe(this.closeCommand,()=>{i&&i.focus(),this.close()}),this.$title=W('<div role="heading" class="heading"></div>'),this.$content.append(this.$title),this.$scroll=W('<div class="scroll"></div>'),this.$content.append(this.$scroll),this.$version=W('<div class="version"></div>'),this.$content.append(this.$version),this.$website=W('<div class="website"></div>'),this.$content.append(this.$website),this.$locale=W('<div class="setting locale"></div>'),this.$scroll.append(this.$locale),this.$localeLabel=W('<label for="locale">'+this.content.locale+"</label>"),this.$locale.append(this.$localeLabel),this.$localeDropDown=W('<select id="locale"></select>'),this.$locale.append(this.$localeDropDown),this.$title.text(this.content.title),this.$website.html(this.content.website),this.$website.targetBlank(),this._createLocalesMenu(),this._createAccessibilityMenu(),this.$element.hide()}getSettings(){return this.extension.getSettings()}updateSettings(i){this.extension.updateSettings(i),this.extensionHost.publish(b.UPDATE_SETTINGS,i)}open(){super.open(),this.$version.text("v"+process.env.PACKAGE_VERSION)}_createLocalesMenu(){let i=this.extension.data.locales;if(i&&i.length>1){for(let a=0;a<i.length;a++){let u=i[a];this.$localeDropDown.append('<option value="'+u.name+'">'+u.label+"</option>")}this.$localeDropDown.val(i[0].name)}else this.$locale.hide();this.$localeDropDown.change(()=>{this.extension.changeLocale(this.$localeDropDown.val())})}resize(){super.resize()}_createAccessibilityMenu(){this.$reducedAnimation=W('<div class="setting reducedAnimation"></div>'),this.$scroll.append(this.$reducedAnimation),this.$reducedAnimationCheckbox=W('<input id="reducedAnimation" type="checkbox" tabindex="0" />'),this.$reducedAnimation.append(this.$reducedAnimationCheckbox),this.$reducedAnimationLabel=W('<label for="reducedAnimation">'+this.content.reducedMotion+"</label>"),this.$reducedAnimation.append(this.$reducedAnimationLabel),this.$reducedAnimationCheckbox.change(()=>{let i={};this.$reducedAnimationCheckbox.is(":checked")?i.reducedAnimation=!0:i.reducedAnimation=!1,this.updateSettings(i)})}};var H=window.$,ne=class extends k{constructor(i){super(i);this.aspectRatio=.75;this.isEmbedViewVisible=!1;this.isShareViewVisible=!1;this.maxWidth=8e3;this.maxHeight=this.maxWidth*this.aspectRatio;this.minWidth=200;this.minHeight=this.minWidth*this.aspectRatio;this.shareManifestsEnabled=!1}create(){this.setConfig("shareDialogue"),super.create(),this.openCommand=b.SHOW_SHARE_DIALOGUE,this.closeCommand=b.HIDE_SHARE_DIALOGUE,this.shareManifestsEnabled=this.options.shareManifestsEnabled||!1;let i;this.extensionHost.subscribe(this.openCommand,u=>{i=u,this.open(u),this.isShareAvailable()?this.openShareView():this.openEmbedView()}),this.extensionHost.subscribe(this.closeCommand,()=>{i&&i.focus(),this.close()}),this.extensionHost.subscribe(b.SHOW_EMBED_DIALOGUE,u=>{this.open(u),this.openEmbedView()}),this.$tabs=H('<div class="tabs"></div>'),this.$content.append(this.$tabs),this.$shareButton=H('<a class="share tab default" tabindex="0">'+this.content.share+"</a>"),R.getBool(this.config.options.shareEnabled,!0)&&this.$tabs.append(this.$shareButton),this.$embedButton=H('<a class="embed tab" tabindex="0">'+this.content.embed+"</a>"),R.getBool(this.config.options.embedEnabled,!1)&&this.$tabs.append(this.$embedButton),this.$tabsContent=H('<div class="tabsContent"></div>'),this.$content.append(this.$tabsContent),this.$footer=H('<div class="footer"></div>'),this.$content.append(this.$footer),this.$shareView=H('<div class="shareView view"></div>'),this.$tabsContent.append(this.$shareView),this.$shareHeader=H('<div class="header"></div>'),this.$shareView.append(this.$shareHeader),this.$shareLink=H('<a class="shareLink" onclick="return false;"></a>'),this.$shareView.append(this.$shareLink),this.$shareInput=H(`<input class="shareInput" type="text" readonly="readonly" aria-label="${this.content.shareUrl}"/>`),this.$shareView.append(this.$shareInput),this.$shareFrame=H('<iframe class="shareFrame"></iframe>'),this.$shareView.append(this.$shareFrame),this.$embedView=H('<div class="embedView view"></div>'),this.$tabsContent.append(this.$embedView),this.$embedHeader=H('<div class="header"></div>'),this.$embedView.append(this.$embedHeader),this.$code=H(`<input class="code" type="text" readonly="readonly" aria-label="${this.content.embed}"/>`),this.$embedView.append(this.$code),this.$customSize=H('<div class="customSize"></div>'),this.$embedView.append(this.$customSize),this.$size=H('<span class="size">'+this.content.size+"</span>"),this.$customSize.append(this.$size),this.$customSizeDropDown=H('<select id="size" aria-label="'+this.content.size+'"></select>'),this.$customSize.append(this.$customSizeDropDown),this.$customSizeDropDown.append('<option value="small" data-width="560" data-height="420">560 x 420</option>'),this.$customSizeDropDown.append('<option value="medium" data-width="640" data-height="480">640 x 480</option>'),this.$customSizeDropDown.append('<option value="large" data-width="800" data-height="600">800 x 600</option>'),this.$customSizeDropDown.append('<option value="custom">'+this.content.customSize+"</option>"),this.$widthInput=H('<input class="width" type="text" maxlength="10" aria-label="'+this.content.width+'"/>'),this.$customSize.append(this.$widthInput),this.$x=H('<span class="x">x</span>'),this.$customSize.append(this.$x),this.$heightInput=H('<input class="height" type="text" maxlength="10" aria-label="'+this.content.height+'"/>'),this.$customSize.append(this.$heightInput);let a=this.extension.getIIIFShareUrl(this.shareManifestsEnabled);this.shareManifestsEnabled&&(this.$iiifButton=H('<a class="imageBtn iiif" href="'+a+'" title="'+this.content.iiif+'" target="_blank"></a>'),this.$footer.append(this.$iiifButton)),this.$termsOfUseButton=H('<a href="#">'+this.extension.data.config.content.termsOfUse+"</a>"),this.$footer.append(this.$termsOfUseButton),this.$widthInput.on("keydown",u=>ft.numericalInput(u)),this.$heightInput.on("keydown",u=>ft.numericalInput(u)),this.$shareInput.focus(function(){H(this).select()}),this.$code.focus(function(){H(this).select()}),this.onAccessibleClick(this.$shareButton,()=>{this.openShareView()}),this.onAccessibleClick(this.$embedButton,()=>{this.openEmbedView()}),this.$customSizeDropDown.change(()=>{this.update()}),this.$widthInput.change(()=>{this.updateHeightRatio(),this.update()}),this.$heightInput.change(()=>{this.updateWidthRatio(),this.update()}),this.onAccessibleClick(this.$termsOfUseButton,()=>{this.extensionHost.publish(b.SHOW_TERMS_OF_USE)}),this.$element.hide(),this.update()}open(i){super.open(i),this.update()}getShareUrl(){return this.extension.getShareUrl()}isShareAvailable(){return!!this.getShareUrl()}update(){this.isShareAvailable()?this.$shareButton.show():this.$shareButton.hide();let i=this.getSelectedSize();i.val()==="custom"?(this.$widthInput.show(),this.$x.show(),this.$heightInput.show()):(this.$widthInput.hide(),this.$x.hide(),this.$heightInput.hide(),this.currentWidth=Number(i.data("width")),this.currentHeight=Number(i.data("height")),this.$widthInput.val(String(this.currentWidth)),this.$heightInput.val(String(this.currentHeight))),this.updateInstructions(),this.updateShareOptions(),this.updateShareFrame(),this.updateTermsOfUseButton()}updateShareOptions(){let i=this.getShareUrl();i&&(this.$shareInput.val(i),this.$shareLink.prop("href",i),this.$shareLink.text(i)),this.extension.isMobile()?(this.$shareInput.hide(),this.$shareLink.show()):(this.$shareInput.show(),this.$shareLink.hide())}updateInstructions(){R.getBool(this.options.instructionsEnabled,!1)?(this.$shareHeader.show(),this.$embedHeader.show(),this.$shareHeader.text(this.content.shareInstructions),this.$embedHeader.text(this.content.embedInstructions)):(this.$shareHeader.hide(),this.$embedHeader.hide())}getSelectedSize(){return this.$customSizeDropDown.find(":selected")}updateWidthRatio(){this.currentHeight=Number(this.$heightInput.val()),this.currentHeight<this.minHeight?(this.currentHeight=this.minHeight,this.$heightInput.val(String(this.currentHeight))):this.currentHeight>this.maxHeight&&(this.currentHeight=this.maxHeight,this.$heightInput.val(String(this.currentHeight))),this.currentWidth=Math.floor(this.currentHeight/this.aspectRatio),this.$widthInput.val(String(this.currentWidth))}updateHeightRatio(){this.currentWidth=Number(this.$widthInput.val()),this.currentWidth<this.minWidth?(this.currentWidth=this.minWidth,this.$widthInput.val(String(this.currentWidth))):this.currentWidth>this.maxWidth&&(this.currentWidth=this.maxWidth,this.$widthInput.val(String(this.currentWidth))),this.currentHeight=Math.floor(this.currentWidth*this.aspectRatio),this.$heightInput.val(String(this.currentHeight))}updateShareFrame(){let i=this.extension.helper.getShareServiceUrl();!i||(R.getBool(this.config.options.shareFrameEnabled,!0)&&i?(this.$shareFrame.prop("src",i),this.$shareFrame.show()):this.$shareFrame.hide())}updateTermsOfUseButton(){let i=this.extension.helper.getRequiredStatement();R.getBool(this.extension.data.config.options.termsOfUseEnabled,!1)&&i&&i.value?this.$termsOfUseButton.show():this.$termsOfUseButton.hide()}openShareView(){this.isShareViewVisible=!0,this.isEmbedViewVisible=!1,this.$embedView.hide(),this.$shareView.show(),this.$shareButton.addClass("on default"),this.$embedButton.removeClass("on default"),this.resize()}openEmbedView(){this.isShareViewVisible=!1,this.isEmbedViewVisible=!0,this.$embedView.show(),this.$shareView.hide(),this.$shareButton.removeClass("on default"),this.$embedButton.addClass("on default"),this.resize()}close(){super.close()}getViews(){return this.$tabsContent.find(".view")}equaliseViewHeights(){this.getViews().equaliseHeight(!0)}resize(){this.equaliseViewHeights(),this.setDockedPosition()}};export{U as a,nt as b,te as c,k as d,B as e,qt as f,ee as g,Yt as h,Xt as i,Vt as j,Kt as k,ie as l,ne as m};
